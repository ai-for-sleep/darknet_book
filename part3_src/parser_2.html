
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>+ parser.c · DarkNet Book</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="JJM">
        
        
    
    

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../website-1608524487893.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
    
    
    

    
    <link rel="next" href="region_layer.html" />
    
    
    <link rel="prev" href="parser_1.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            <div class="book-logo">   
                
                <img src="/darknet_book/assets/darknet.png"/>
                
            </div>
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
        <li class="header ">DARKNET</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="1.1" 
            data-path="../">

            
                <a href="../">
            
                    
                    DarkNet
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="1.2" 
            data-path="../INSTALL.html">

            
                <a href="../INSTALL.html">
            
                    
                    설치하기
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">Paper</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="2.1" 
            data-path="../part1_paper/yolov1.html">

            
                <a href="../part1_paper/yolov1.html">
            
                    
                    YOLOv1
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="2.2" 
            data-path="../part1_paper/yolov2.html">

            
                <a href="../part1_paper/yolov2.html">
            
                    
                    YOLOv2
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="2.3" 
            data-path="../part1_paper/yolov3.html">

            
                <a href="../part1_paper/yolov3.html">
            
                    
                    YOLOv3
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="2.4" 
            data-path="../part1_paper/yolov4.html">

            
                <a href="../part1_paper/yolov4.html">
            
                    
                    YOLOv4
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">SOURCE</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="3.1" 
            data-path="../part2_source/0_Project.html">

            
                <a href="../part2_source/0_Project.html">
            
                    
                    project
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.2" 
            data-path="../part2_source/1_DATA.html">

            
                <a href="../part2_source/1_DATA.html">
            
                    
                    /data
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.3" 
            data-path="../part2_source/2_CFG.html">

            
                <a href="../part2_source/2_CFG.html">
            
                    
                    /cfg
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.4" 
            data-path="../part2_source/3_EXAMPLE.html">

            
                <a href="../part2_source/3_EXAMPLE.html">
            
                    
                    /example
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.5" 
            data-path="../part2_source/4_SRC.html">

            
                <a href="../part2_source/4_SRC.html">
            
                    
                    /src
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">Structure</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="4.1" 
            data-path="../part4_structure/network.html">

            
                <a href="../part4_structure/network.html">
            
                    
                    network
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="4.2" 
            data-path="../part4_structure/layer.html">

            
                <a href="../part4_structure/layer.html">
            
                    
                    layer
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="4.3" 
            data-path="../part4_structure/etc.html">

            
                <a href="../part4_structure/etc.html">
            
                    
                    etc
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header  selected ">/SRC</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="5.1" 
            data-path="activation_layer.html">

            
                <a href="activation_layer.html">
            
                    
                    activation_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.2" 
            data-path="activations_1.html">

            
                <a href="activations_1.html">
            
                    
                    activations.c
            
                </a>
            

            
            <ul class="articles">
                
                
    
        
        <li class="chapter 
               hide "
            data-level="5.2.1" 
            data-path="activations_2.html">

            
                <a href="activations_2.html">
            
                    
                    activation.h
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.3" 
            data-path="avgpool.html">

            
                <a href="avgpool.html">
            
                    
                    avgpool_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.4" 
            data-path="batchnorm_layer.html">

            
                <a href="batchnorm_layer.html">
            
                    
                    batchnorm_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.5" 
            data-path="blas.html">

            
                <a href="blas.html">
            
                    
                    blas.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.6" 
            data-path="box.html">

            
                <a href="box.html">
            
                    
                    box.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.7" 
            data-path="col2im.html">

            
                <a href="col2im.html">
            
                    
                    col2im.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.8" 
            data-path="compare.html">

            
                <a href="compare.html">
            
                    
                    compare.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.9" 
            data-path="connected_layer.html">

            
                <a href="connected_layer.html">
            
                    
                    connected_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.10" 
            data-path="convolutional_layer.html">

            
                <a href="convolutional_layer.html">
            
                    
                    convolutional_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.11" 
            data-path="cost_layer.html">

            
                <a href="cost_layer.html">
            
                    
                    cost_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.12" 
            data-path="crnn_layer.html">

            
                <a href="crnn_layer.html">
            
                    
                    crnn_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.13" 
            data-path="crop_layer.html">

            
                <a href="crop_layer.html">
            
                    
                    crop_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.14" 
            data-path="data.html">

            
                <a href="data.html">
            
                    
                    data.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.15" 
            data-path="deconvolutional_layer.html">

            
                <a href="deconvolutional_layer.html">
            
                    
                    deconvolutional_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.16" 
            data-path="demo.html">

            
                <a href="demo.html">
            
                    
                    demo.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.17" 
            data-path="detection_layer.html">

            
                <a href="detection_layer.html">
            
                    
                    detection_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.18" 
            data-path="dropout_layer.html">

            
                <a href="dropout_layer.html">
            
                    
                    dropout_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.19" 
            data-path="gemm.html">

            
                <a href="gemm.html">
            
                    
                    gemm.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.20" 
            data-path="gru_layer.html">

            
                <a href="gru_layer.html">
            
                    
                    gru_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.21" 
            data-path="im2col.html">

            
                <a href="im2col.html">
            
                    
                    im2col.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.22" 
            data-path="image.html">

            
                <a href="image.html">
            
                    
                    image.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.23" 
            data-path="iseg_layer.html">

            
                <a href="iseg_layer.html">
            
                    
                    iseg_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.24" 
            data-path="l2norm_layer.html">

            
                <a href="l2norm_layer.html">
            
                    
                    l2norm_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.25" 
            data-path="layer.html">

            
                <a href="layer.html">
            
                    
                    layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.26" 
            data-path="list.html">

            
                <a href="list.html">
            
                    
                    list.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.27" 
            data-path="local_layer.html">

            
                <a href="local_layer.html">
            
                    
                    local_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.28" 
            data-path="logistic_layer.html">

            
                <a href="logistic_layer.html">
            
                    
                    logistic_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.29" 
            data-path="lstm_layer.html">

            
                <a href="lstm_layer.html">
            
                    
                    lstm_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.30" 
            data-path="matrix.html">

            
                <a href="matrix.html">
            
                    
                    matrix.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.31" 
            data-path="maxpool.html">

            
                <a href="maxpool.html">
            
                    
                    maxpool_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.32" 
            data-path="network.html">

            
                <a href="network.html">
            
                    
                    network.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.33" 
            data-path="normalization_layer.html">

            
                <a href="normalization_layer.html">
            
                    
                    normalization_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.34" 
            data-path="option_list.html">

            
                <a href="option_list.html">
            
                    
                    option_list.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              selected  "
            data-level="5.35" 
            data-path="parser_1.html">

            
                <a href="parser_1.html">
            
                    
                    parser.c
            
                </a>
            

            
            <ul class="articles">
                  
                
    
        
        <li class="chapter 
            active  selected  "
            data-level="5.35.1" 
            data-path="parser_2.html">

            
                <a href="parser_2.html">
            
                    
                    + parser.c
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.36" 
            data-path="region_layer.html">

            
                <a href="region_layer.html">
            
                    
                    region_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.37" 
            data-path="reorg_layer.html">

            
                <a href="reorg_layer.html">
            
                    
                    reorg_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.38" 
            data-path="rnn_layer.html">

            
                <a href="rnn_layer.html">
            
                    
                    rnn_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.39" 
            data-path="route_layer.html">

            
                <a href="route_layer.html">
            
                    
                    route_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.40" 
            data-path="shortcut.md">

            
                <span>
            
                    
                    shortcut_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.41" 
            data-path="softmax_layer.html">

            
                <a href="softmax_layer.html">
            
                    
                    softmax_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.42" 
            data-path="tree.html">

            
                <a href="tree.html">
            
                    
                    tree.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.43" 
            data-path="upsample_layer.html">

            
                <a href="upsample_layer.html">
            
                    
                    upsample_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.44" 
            data-path="utils.html">

            
                <a href="utils.html">
            
                    
                    utils.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.45" 
            data-path="yolo_layer.html">

            
                <a href="yolo_layer.html">
            
                    
                    yolo_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.46" 
            data-path="image_opencv.html">

            
                <a href="image_opencv.html">
            
                    
                    image_opencv.cpp
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">/EXAMPLE</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="6.1" 
            data-path="../part5_examples/art.html">

            
                <a href="../part5_examples/art.html">
            
                    
                    art.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.2" 
            data-path="../part5_examples/attention.html">

            
                <a href="../part5_examples/attention.html">
            
                    
                    attention.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.3" 
            data-path="../part5_examples/captcha.html">

            
                <a href="../part5_examples/captcha.html">
            
                    
                    captcha.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.4" 
            data-path="../part5_examples/cifar.html">

            
                <a href="../part5_examples/cifar.html">
            
                    
                    cifar.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.5" 
            data-path="../part5_examples/classifier.html">

            
                <a href="../part5_examples/classifier.html">
            
                    
                    classifier.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.6" 
            data-path="../part5_examples/coco.html">

            
                <a href="../part5_examples/coco.html">
            
                    
                    coco.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.7" 
            data-path="../part5_examples/darknet.html">

            
                <a href="../part5_examples/darknet.html">
            
                    
                    darknet.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.8" 
            data-path="../part5_examples/detector.html">

            
                <a href="../part5_examples/detector.html">
            
                    
                    detector.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.9" 
            data-path="../part5_examples/dice.html">

            
                <a href="../part5_examples/dice.html">
            
                    
                    dice.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.10" 
            data-path="../part5_examples/go.html">

            
                <a href="../part5_examples/go.html">
            
                    
                    go.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.11" 
            data-path="../part5_examples/instance-segmenter.html">

            
                <a href="../part5_examples/instance-segmenter.html">
            
                    
                    instance-segmenter.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.12" 
            data-path="../part5_examples/lsd.html">

            
                <a href="../part5_examples/lsd.html">
            
                    
                    lsd.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.13" 
            data-path="../part5_examples/nightmare.html">

            
                <a href="../part5_examples/nightmare.html">
            
                    
                    nightmare.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.14" 
            data-path="../part5_examples/regressor.html">

            
                <a href="../part5_examples/regressor.html">
            
                    
                    regressor.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.15" 
            data-path="../part5_examples/rnn.html">

            
                <a href="../part5_examples/rnn.html">
            
                    
                    rnn.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.16" 
            data-path="../part5_examples/rnn_vid.html">

            
                <a href="../part5_examples/rnn_vid.html">
            
                    
                    rnn_vid.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.17" 
            data-path="../part5_examples/segmenter.html">

            
                <a href="../part5_examples/segmenter.html">
            
                    
                    segmenter.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.18" 
            data-path="../part5_examples/super.html">

            
                <a href="../part5_examples/super.html">
            
                    
                    super.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.19" 
            data-path="../part5_examples/swag.html">

            
                <a href="../part5_examples/swag.html">
            
                    
                    swag.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.20" 
            data-path="../part5_examples/tag.html">

            
                <a href="../part5_examples/tag.html">
            
                    
                    tag.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.21" 
            data-path="../part5_examples/voxel.html">

            
                <a href="../part5_examples/voxel.html">
            
                    
                    voxel.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.22" 
            data-path="../part5_examples/writing.html">

            
                <a href="../part5_examples/writing.html">
            
                    
                    writing.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.23" 
            data-path="../part5_examples/yolo.html">

            
                <a href="../part5_examples/yolo.html">
            
                    
                    yolo.c
            
                </a>
            

            
        </li>
    

    
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >+ parser.c</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="freesection">free_section</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">free_section</span><span class="hljs-params">(section *s)</span>
</span>{
    <span class="hljs-built_in">free</span>(s-&gt;type);
    node *n = s-&gt;options-&gt;front;
    <span class="hljs-keyword">while</span>(n){
        kvp *pair = (kvp *)n-&gt;val;
        <span class="hljs-built_in">free</span>(pair-&gt;key);
        <span class="hljs-built_in">free</span>(pair);
        node *next = n-&gt;next;
        <span class="hljs-built_in">free</span>(n);
        n = next;
    }
    <span class="hljs-built_in">free</span>(s-&gt;options);
    <span class="hljs-built_in">free</span>(s);
}
</code></pre>
<ul>
<li>section&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xD560;&#xB2F9;&#xC744; &#xD574;&#xC81C;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsedata">parse_data</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">parse_data</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *data, <span class="hljs-keyword">float</span> *a, <span class="hljs-keyword">int</span> n)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">if</span>(!data) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">char</span> *curr = data;

    <span class="hljs-keyword">char</span> *next = data;
    <span class="hljs-keyword">int</span> done = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; n &amp;&amp; !done; ++i){
        <span class="hljs-keyword">while</span>(*++next !=<span class="hljs-string">&apos;\0&apos;</span> &amp;&amp; *next != <span class="hljs-string">&apos;,&apos;</span>);
        <span class="hljs-keyword">if</span>(*next == <span class="hljs-string">&apos;\0&apos;</span>) done = <span class="hljs-number">1</span>;
        *next = <span class="hljs-string">&apos;\0&apos;</span>;
        <span class="hljs-built_in">sscanf</span>(curr, <span class="hljs-string">&quot;%g&quot;</span>, &amp;a[i]);
        curr = next+<span class="hljs-number">1</span>;
    }
}
</code></pre>
<ul>
<li><code>%g</code> : &#xC22B;&#xC790;&#xC5D0; &#xD06C;&#xAE30;&#xC5D0; &#xB530;&#xB77C;&#xC11C; f(123.456)&#xB098; e(12.3456e + 001)&#xB85C; &#xCD9C;&#xB825;&#xD569;&#xB2C8;&#xB2E4;.</li>
<li><code>sscanf(curr, &quot;%g&quot;, &amp;a[i]);</code> curr&#xC5D0; &#xC800;&#xC7A5;&#xB41C; &#xAC12;&#xC774; a[i]&#xC5D0; %g &#xD615;&#xD0DC;&#xB85C; &#xC785;&#xB825;&#xB429;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parselocal">parse_local</h2>
<pre><code class="lang-c"><span class="hljs-function">local_layer <span class="hljs-title">parse_local</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> n = option_find_int(options, <span class="hljs-string">&quot;filters&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> size = option_find_int(options, <span class="hljs-string">&quot;size&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> stride = option_find_int(options, <span class="hljs-string">&quot;stride&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> pad = option_find_int(options, <span class="hljs-string">&quot;pad&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;logistic&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);

    <span class="hljs-keyword">int</span> batch,h,w,c;
    h = params.h;
    w = params.w;
    c = params.c;
    batch=params.batch;
    <span class="hljs-keyword">if</span>(!(h &amp;&amp; w &amp;&amp; c)) error(<span class="hljs-string">&quot;Layer before local layer must output image.&quot;</span>);

    local_layer layer = make_local_layer(batch,h,w,c,n,size,stride,pad,activation);

    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>local layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsedeconvolutional">parse_deconvolutional</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_deconvolutional</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> n = option_find_int(options, <span class="hljs-string">&quot;filters&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> size = option_find_int(options, <span class="hljs-string">&quot;size&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> stride = option_find_int(options, <span class="hljs-string">&quot;stride&quot;</span>,<span class="hljs-number">1</span>);

    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;logistic&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);

    <span class="hljs-keyword">int</span> batch,h,w,c;
    h = params.h;
    w = params.w;
    c = params.c;
    batch=params.batch;
    <span class="hljs-keyword">if</span>(!(h &amp;&amp; w &amp;&amp; c)) error(<span class="hljs-string">&quot;Layer before deconvolutional layer must output image.&quot;</span>);
    <span class="hljs-keyword">int</span> batch_normalize = option_find_int_quiet(options, <span class="hljs-string">&quot;batch_normalize&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> pad = option_find_int_quiet(options, <span class="hljs-string">&quot;pad&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> padding = option_find_int_quiet(options, <span class="hljs-string">&quot;padding&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(pad) padding = size/<span class="hljs-number">2</span>;

    layer l = make_deconvolutional_layer(batch,h,w,c,n,size,stride,padding, activation, batch_normalize, params.net-&gt;adam);

    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>deconvolutional layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseconvolutional">parse_convolutional</h2>
<pre><code class="lang-c"><span class="hljs-function">convolutional_layer <span class="hljs-title">parse_convolutional</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> n = option_find_int(options, <span class="hljs-string">&quot;filters&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> size = option_find_int(options, <span class="hljs-string">&quot;size&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> stride = option_find_int(options, <span class="hljs-string">&quot;stride&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> pad = option_find_int_quiet(options, <span class="hljs-string">&quot;pad&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> padding = option_find_int_quiet(options, <span class="hljs-string">&quot;padding&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> groups = option_find_int_quiet(options, <span class="hljs-string">&quot;groups&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span>(pad) padding = size/<span class="hljs-number">2</span>;

    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;logistic&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);

    <span class="hljs-keyword">int</span> batch,h,w,c;
    h = params.h;
    w = params.w;
    c = params.c;
    batch=params.batch;
    <span class="hljs-keyword">if</span>(!(h &amp;&amp; w &amp;&amp; c)) error(<span class="hljs-string">&quot;Layer before convolutional layer must output image.&quot;</span>);
    <span class="hljs-keyword">int</span> batch_normalize = option_find_int_quiet(options, <span class="hljs-string">&quot;batch_normalize&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> binary = option_find_int_quiet(options, <span class="hljs-string">&quot;binary&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> xnor = option_find_int_quiet(options, <span class="hljs-string">&quot;xnor&quot;</span>, <span class="hljs-number">0</span>);

    convolutional_layer layer = make_convolutional_layer(batch,h,w,c,n,groups,size,stride,padding,activation, batch_normalize, binary, xnor, params.net-&gt;adam);
    layer.flipped = option_find_int_quiet(options, <span class="hljs-string">&quot;flipped&quot;</span>, <span class="hljs-number">0</span>);
    layer.dot = option_find_float_quiet(options, <span class="hljs-string">&quot;dot&quot;</span>, <span class="hljs-number">0</span>);

    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>convolutional layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsecrnn">parse_crnn</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_crnn</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> output_filters = option_find_int(options, <span class="hljs-string">&quot;output_filters&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> hidden_filters = option_find_int(options, <span class="hljs-string">&quot;hidden_filters&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;logistic&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);
    <span class="hljs-keyword">int</span> batch_normalize = option_find_int_quiet(options, <span class="hljs-string">&quot;batch_normalize&quot;</span>, <span class="hljs-number">0</span>);

    layer l = make_crnn_layer(params.batch, params.w, params.h, params.c, hidden_filters, output_filters, params.time_steps, activation, batch_normalize);

    l.shortcut = option_find_int_quiet(options, <span class="hljs-string">&quot;shortcut&quot;</span>, <span class="hljs-number">0</span>);

    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>crnn layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsernn">parse_rnn</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_rnn</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> output = option_find_int(options, <span class="hljs-string">&quot;output&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;logistic&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);
    <span class="hljs-keyword">int</span> batch_normalize = option_find_int_quiet(options, <span class="hljs-string">&quot;batch_normalize&quot;</span>, <span class="hljs-number">0</span>);

    layer l = make_rnn_layer(params.batch, params.inputs, output, params.time_steps, activation, batch_normalize, params.net-&gt;adam);

    l.shortcut = option_find_int_quiet(options, <span class="hljs-string">&quot;shortcut&quot;</span>, <span class="hljs-number">0</span>);

    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>rnn layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsegru">parse_gru</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_gru</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> output = option_find_int(options, <span class="hljs-string">&quot;output&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> batch_normalize = option_find_int_quiet(options, <span class="hljs-string">&quot;batch_normalize&quot;</span>, <span class="hljs-number">0</span>);

    layer l = make_gru_layer(params.batch, params.inputs, output, params.time_steps, batch_normalize, params.net-&gt;adam);
    l.<span class="hljs-built_in">tanh</span> = option_find_int_quiet(options, <span class="hljs-string">&quot;tanh&quot;</span>, <span class="hljs-number">0</span>);

    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>gru layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parselstm">parse_lstm</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_lstm</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> output = option_find_int(options, <span class="hljs-string">&quot;output&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> batch_normalize = option_find_int_quiet(options, <span class="hljs-string">&quot;batch_normalize&quot;</span>, <span class="hljs-number">0</span>);

    layer l = make_lstm_layer(params.batch, params.inputs, output, params.time_steps, batch_normalize, params.net-&gt;adam);

    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>lstm layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseconnected">parse_connected</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_connected</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> output = option_find_int(options, <span class="hljs-string">&quot;output&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;logistic&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);
    <span class="hljs-keyword">int</span> batch_normalize = option_find_int_quiet(options, <span class="hljs-string">&quot;batch_normalize&quot;</span>, <span class="hljs-number">0</span>);

    layer l = make_connected_layer(params.batch, params.inputs, output, activation, batch_normalize, params.net-&gt;adam);
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>connected layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsesoftmax">parse_softmax</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_softmax</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> groups = option_find_int_quiet(options, <span class="hljs-string">&quot;groups&quot;</span>,<span class="hljs-number">1</span>);
    layer l = make_softmax_layer(params.batch, params.inputs, groups);
    l.temperature = option_find_float_quiet(options, <span class="hljs-string">&quot;temperature&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">char</span> *tree_file = option_find_str(options, <span class="hljs-string">&quot;tree&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (tree_file) l.softmax_tree = read_tree(tree_file);
    l.w = params.w;
    l.h = params.h;
    l.c = params.c;
    l.spatial = option_find_float_quiet(options, <span class="hljs-string">&quot;spatial&quot;</span>, <span class="hljs-number">0</span>);
    l.noloss =  option_find_int_quiet(options, <span class="hljs-string">&quot;noloss&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>softmax layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseyolomask">parse_yolo_mask</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> *<span class="hljs-title">parse_yolo_mask</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *a, <span class="hljs-keyword">int</span> *num)</span>
</span>{
    <span class="hljs-keyword">int</span> *mask = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(a){
        <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(a);
        <span class="hljs-keyword">int</span> n = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> i;
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; len; ++i){
            <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">&apos;,&apos;</span>) ++n;
        }
        mask = <span class="hljs-built_in">calloc</span>(n, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; n; ++i){
            <span class="hljs-keyword">int</span> val = atoi(a);
            mask[i] = val;
            a = <span class="hljs-built_in">strchr</span>(a, <span class="hljs-string">&apos;,&apos;</span>)+<span class="hljs-number">1</span>;
        }
        *num = n;
    }
    <span class="hljs-keyword">return</span> mask;
}
</code></pre>
<h2 id="parseyolo">parse_yolo</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_yolo</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> classes = option_find_int(options, <span class="hljs-string">&quot;classes&quot;</span>, <span class="hljs-number">20</span>);
    <span class="hljs-keyword">int</span> total = option_find_int(options, <span class="hljs-string">&quot;num&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> num = total;

    <span class="hljs-keyword">char</span> *a = option_find_str(options, <span class="hljs-string">&quot;mask&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> *mask = parse_yolo_mask(a, &amp;num);
    layer l = make_yolo_layer(params.batch, params.w, params.h, num, total, mask, classes);
    assert(l.outputs == params.inputs);

    l.max_boxes = option_find_int_quiet(options, <span class="hljs-string">&quot;max&quot;</span>,<span class="hljs-number">90</span>);
    l.jitter = option_find_float(options, <span class="hljs-string">&quot;jitter&quot;</span>, <span class="hljs-number">.2</span>);

    l.ignore_thresh = option_find_float(options, <span class="hljs-string">&quot;ignore_thresh&quot;</span>, <span class="hljs-number">.5</span>);
    l.truth_thresh = option_find_float(options, <span class="hljs-string">&quot;truth_thresh&quot;</span>, <span class="hljs-number">1</span>);
    l.random = option_find_int_quiet(options, <span class="hljs-string">&quot;random&quot;</span>, <span class="hljs-number">0</span>);

    <span class="hljs-keyword">char</span> *map_file = option_find_str(options, <span class="hljs-string">&quot;map&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (map_file) l.<span class="hljs-built_in">map</span> = read_map(map_file);

    a = option_find_str(options, <span class="hljs-string">&quot;anchors&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(a){
        <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(a);
        <span class="hljs-keyword">int</span> n = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> i;
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; len; ++i){
            <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">&apos;,&apos;</span>) ++n;
        }
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; n; ++i){
            <span class="hljs-keyword">float</span> bias = atof(a);
            l.biases[i] = bias;
            a = <span class="hljs-built_in">strchr</span>(a, <span class="hljs-string">&apos;,&apos;</span>)+<span class="hljs-number">1</span>;
        }
    }
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>yolo layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseiseg">parse_iseg</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_iseg</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> classes = option_find_int(options, <span class="hljs-string">&quot;classes&quot;</span>, <span class="hljs-number">20</span>);
    <span class="hljs-keyword">int</span> ids = option_find_int(options, <span class="hljs-string">&quot;ids&quot;</span>, <span class="hljs-number">32</span>);
    layer l = make_iseg_layer(params.batch, params.w, params.h, classes, ids);
    assert(l.outputs == params.inputs);
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>iseg layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseregion">parse_region</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_region</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> coords = option_find_int(options, <span class="hljs-string">&quot;coords&quot;</span>, <span class="hljs-number">4</span>);
    <span class="hljs-keyword">int</span> classes = option_find_int(options, <span class="hljs-string">&quot;classes&quot;</span>, <span class="hljs-number">20</span>);
    <span class="hljs-keyword">int</span> num = option_find_int(options, <span class="hljs-string">&quot;num&quot;</span>, <span class="hljs-number">1</span>);

    layer l = make_region_layer(params.batch, params.w, params.h, num, classes, coords);
    assert(l.outputs == params.inputs);

    l.<span class="hljs-built_in">log</span> = option_find_int_quiet(options, <span class="hljs-string">&quot;log&quot;</span>, <span class="hljs-number">0</span>);
    l.<span class="hljs-built_in">sqrt</span> = option_find_int_quiet(options, <span class="hljs-string">&quot;sqrt&quot;</span>, <span class="hljs-number">0</span>);

    l.softmax = option_find_int(options, <span class="hljs-string">&quot;softmax&quot;</span>, <span class="hljs-number">0</span>);
    l.background = option_find_int_quiet(options, <span class="hljs-string">&quot;background&quot;</span>, <span class="hljs-number">0</span>);
    l.max_boxes = option_find_int_quiet(options, <span class="hljs-string">&quot;max&quot;</span>,<span class="hljs-number">30</span>);
    l.jitter = option_find_float(options, <span class="hljs-string">&quot;jitter&quot;</span>, <span class="hljs-number">.2</span>);
    l.rescore = option_find_int_quiet(options, <span class="hljs-string">&quot;rescore&quot;</span>,<span class="hljs-number">0</span>);

    l.thresh = option_find_float(options, <span class="hljs-string">&quot;thresh&quot;</span>, <span class="hljs-number">.5</span>);
    l.classfix = option_find_int_quiet(options, <span class="hljs-string">&quot;classfix&quot;</span>, <span class="hljs-number">0</span>);
    l.absolute = option_find_int_quiet(options, <span class="hljs-string">&quot;absolute&quot;</span>, <span class="hljs-number">0</span>);
    l.random = option_find_int_quiet(options, <span class="hljs-string">&quot;random&quot;</span>, <span class="hljs-number">0</span>);

    l.coord_scale = option_find_float(options, <span class="hljs-string">&quot;coord_scale&quot;</span>, <span class="hljs-number">1</span>);
    l.object_scale = option_find_float(options, <span class="hljs-string">&quot;object_scale&quot;</span>, <span class="hljs-number">1</span>);
    l.noobject_scale = option_find_float(options, <span class="hljs-string">&quot;noobject_scale&quot;</span>, <span class="hljs-number">1</span>);
    l.mask_scale = option_find_float(options, <span class="hljs-string">&quot;mask_scale&quot;</span>, <span class="hljs-number">1</span>);
    l.class_scale = option_find_float(options, <span class="hljs-string">&quot;class_scale&quot;</span>, <span class="hljs-number">1</span>);
    l.bias_match = option_find_int_quiet(options, <span class="hljs-string">&quot;bias_match&quot;</span>,<span class="hljs-number">0</span>);

    <span class="hljs-keyword">char</span> *tree_file = option_find_str(options, <span class="hljs-string">&quot;tree&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (tree_file) l.softmax_tree = read_tree(tree_file);
    <span class="hljs-keyword">char</span> *map_file = option_find_str(options, <span class="hljs-string">&quot;map&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (map_file) l.<span class="hljs-built_in">map</span> = read_map(map_file);

    <span class="hljs-keyword">char</span> *a = option_find_str(options, <span class="hljs-string">&quot;anchors&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(a){
        <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(a);
        <span class="hljs-keyword">int</span> n = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> i;
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; len; ++i){
            <span class="hljs-keyword">if</span> (a[i] == <span class="hljs-string">&apos;,&apos;</span>) ++n;
        }
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; n; ++i){
            <span class="hljs-keyword">float</span> bias = atof(a);
            l.biases[i] = bias;
            a = <span class="hljs-built_in">strchr</span>(a, <span class="hljs-string">&apos;,&apos;</span>)+<span class="hljs-number">1</span>;
        }
    }
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>region layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsedetection">parse_detection</h2>
<pre><code class="lang-c"><span class="hljs-function">detection_layer <span class="hljs-title">parse_detection</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> coords = option_find_int(options, <span class="hljs-string">&quot;coords&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> classes = option_find_int(options, <span class="hljs-string">&quot;classes&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> rescore = option_find_int(options, <span class="hljs-string">&quot;rescore&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> num = option_find_int(options, <span class="hljs-string">&quot;num&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> side = option_find_int(options, <span class="hljs-string">&quot;side&quot;</span>, <span class="hljs-number">7</span>);
    detection_layer layer = make_detection_layer(params.batch, params.inputs, num, side, classes, coords, rescore);

    layer.softmax = option_find_int(options, <span class="hljs-string">&quot;softmax&quot;</span>, <span class="hljs-number">0</span>);
    layer.<span class="hljs-built_in">sqrt</span> = option_find_int(options, <span class="hljs-string">&quot;sqrt&quot;</span>, <span class="hljs-number">0</span>);

    layer.max_boxes = option_find_int_quiet(options, <span class="hljs-string">&quot;max&quot;</span>,<span class="hljs-number">90</span>);
    layer.coord_scale = option_find_float(options, <span class="hljs-string">&quot;coord_scale&quot;</span>, <span class="hljs-number">1</span>);
    layer.forced = option_find_int(options, <span class="hljs-string">&quot;forced&quot;</span>, <span class="hljs-number">0</span>);
    layer.object_scale = option_find_float(options, <span class="hljs-string">&quot;object_scale&quot;</span>, <span class="hljs-number">1</span>);
    layer.noobject_scale = option_find_float(options, <span class="hljs-string">&quot;noobject_scale&quot;</span>, <span class="hljs-number">1</span>);
    layer.class_scale = option_find_float(options, <span class="hljs-string">&quot;class_scale&quot;</span>, <span class="hljs-number">1</span>);
    layer.jitter = option_find_float(options, <span class="hljs-string">&quot;jitter&quot;</span>, <span class="hljs-number">.2</span>);
    layer.random = option_find_int_quiet(options, <span class="hljs-string">&quot;random&quot;</span>, <span class="hljs-number">0</span>);
    layer.reorg = option_find_int_quiet(options, <span class="hljs-string">&quot;reorg&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>detection layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsecost">parse_cost</h2>
<pre><code class="lang-c"><span class="hljs-function">cost_layer <span class="hljs-title">parse_cost</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">char</span> *type_s = option_find_str(options, <span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;sse&quot;</span>);
    COST_TYPE type = get_cost_type(type_s);
    <span class="hljs-keyword">float</span> scale = option_find_float_quiet(options, <span class="hljs-string">&quot;scale&quot;</span>,<span class="hljs-number">1</span>);
    cost_layer layer = make_cost_layer(params.batch, params.inputs, type, scale);
    layer.ratio =  option_find_float_quiet(options, <span class="hljs-string">&quot;ratio&quot;</span>,<span class="hljs-number">0</span>);
    layer.noobject_scale =  option_find_float_quiet(options, <span class="hljs-string">&quot;noobj&quot;</span>, <span class="hljs-number">1</span>);
    layer.thresh =  option_find_float_quiet(options, <span class="hljs-string">&quot;thresh&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>cost layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsecrop">parse_crop</h2>
<pre><code class="lang-c"><span class="hljs-function">crop_layer <span class="hljs-title">parse_crop</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> crop_height = option_find_int(options, <span class="hljs-string">&quot;crop_height&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> crop_width = option_find_int(options, <span class="hljs-string">&quot;crop_width&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> flip = option_find_int(options, <span class="hljs-string">&quot;flip&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">float</span> angle = option_find_float(options, <span class="hljs-string">&quot;angle&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">float</span> saturation = option_find_float(options, <span class="hljs-string">&quot;saturation&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">float</span> exposure = option_find_float(options, <span class="hljs-string">&quot;exposure&quot;</span>,<span class="hljs-number">1</span>);

    <span class="hljs-keyword">int</span> batch,h,w,c;
    h = params.h;
    w = params.w;
    c = params.c;
    batch=params.batch;
    <span class="hljs-keyword">if</span>(!(h &amp;&amp; w &amp;&amp; c)) error(<span class="hljs-string">&quot;Layer before crop layer must output image.&quot;</span>);

    <span class="hljs-keyword">int</span> noadjust = option_find_int_quiet(options, <span class="hljs-string">&quot;noadjust&quot;</span>,<span class="hljs-number">0</span>);

    crop_layer l = make_crop_layer(batch,h,w,c,crop_height,crop_width,flip, angle, saturation, exposure);
    l.shift = option_find_float(options, <span class="hljs-string">&quot;shift&quot;</span>, <span class="hljs-number">0</span>);
    l.noadjust = noadjust;
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>crop layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsereorg">parse_reorg</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_reorg</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> stride = option_find_int(options, <span class="hljs-string">&quot;stride&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> reverse = option_find_int_quiet(options, <span class="hljs-string">&quot;reverse&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> flatten = option_find_int_quiet(options, <span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> extra = option_find_int_quiet(options, <span class="hljs-string">&quot;extra&quot;</span>,<span class="hljs-number">0</span>);

    <span class="hljs-keyword">int</span> batch,h,w,c;
    h = params.h;
    w = params.w;
    c = params.c;
    batch=params.batch;
    <span class="hljs-keyword">if</span>(!(h &amp;&amp; w &amp;&amp; c)) error(<span class="hljs-string">&quot;Layer before reorg layer must output image.&quot;</span>);

    layer layer = make_reorg_layer(batch,w,h,c,stride,reverse, flatten, extra);
    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>reorg layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsemaxpool">parse_maxpool</h2>
<pre><code class="lang-c"><span class="hljs-function">maxpool_layer <span class="hljs-title">parse_maxpool</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> stride = option_find_int(options, <span class="hljs-string">&quot;stride&quot;</span>,<span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> size = option_find_int(options, <span class="hljs-string">&quot;size&quot;</span>,stride);
    <span class="hljs-keyword">int</span> padding = option_find_int_quiet(options, <span class="hljs-string">&quot;padding&quot;</span>, size<span class="hljs-number">-1</span>);

    <span class="hljs-keyword">int</span> batch,h,w,c;
    h = params.h;
    w = params.w;
    c = params.c;
    batch=params.batch;
    <span class="hljs-keyword">if</span>(!(h &amp;&amp; w &amp;&amp; c)) error(<span class="hljs-string">&quot;Layer before maxpool layer must output image.&quot;</span>);

    maxpool_layer layer = make_maxpool_layer(batch,h,w,c,size,stride,padding);
    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>maxpooling layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseavgpool">parse_avgpool</h2>
<pre><code class="lang-c"><span class="hljs-function">avgpool_layer <span class="hljs-title">parse_avgpool</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">int</span> batch,w,h,c;
    w = params.w;
    h = params.h;
    c = params.c;
    batch=params.batch;
    <span class="hljs-keyword">if</span>(!(h &amp;&amp; w &amp;&amp; c)) error(<span class="hljs-string">&quot;Layer before avgpool layer must output image.&quot;</span>);

    avgpool_layer layer = make_avgpool_layer(batch,w,h,c);
    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>avgpooling layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsedropout">parse_dropout</h2>
<pre><code class="lang-c"><span class="hljs-function">dropout_layer <span class="hljs-title">parse_dropout</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">float</span> probability = option_find_float(options, <span class="hljs-string">&quot;probability&quot;</span>, <span class="hljs-number">.5</span>);
    dropout_layer layer = make_dropout_layer(params.batch, params.inputs, probability);
    layer.out_w = params.w;
    layer.out_h = params.h;
    layer.out_c = params.c;
    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>dropout layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsenormalization">parse_normalization</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_normalization</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">float</span> alpha = option_find_float(options, <span class="hljs-string">&quot;alpha&quot;</span>, <span class="hljs-number">.0001</span>);
    <span class="hljs-keyword">float</span> beta =  option_find_float(options, <span class="hljs-string">&quot;beta&quot;</span> , <span class="hljs-number">.75</span>);
    <span class="hljs-keyword">float</span> kappa = option_find_float(options, <span class="hljs-string">&quot;kappa&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> size = option_find_int(options, <span class="hljs-string">&quot;size&quot;</span>, <span class="hljs-number">5</span>);
    layer l = make_normalization_layer(params.batch, params.w, params.h, params.c, size, alpha, beta, kappa);
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>normalization layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsebatchnorm">parse_batchnorm</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_batchnorm</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    layer l = make_batchnorm_layer(params.batch, params.w, params.h, params.c);
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>batch normalization layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseshortcut">parse_shortcut</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_shortcut</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params, network *net)</span>
</span>{
    <span class="hljs-keyword">char</span> *l = option_find(options, <span class="hljs-string">&quot;from&quot;</span>);
    <span class="hljs-keyword">int</span> index = atoi(l);
    <span class="hljs-keyword">if</span>(index &lt; <span class="hljs-number">0</span>) index = params.index + index;

    <span class="hljs-keyword">int</span> batch = params.batch;
    layer from = net-&gt;layers[index];

    layer s = make_shortcut_layer(batch, index, params.w, params.h, params.c, from.out_w, from.out_h, from.out_c);

    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;linear&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);
    s.activation = activation;
    s.alpha = option_find_float_quiet(options, <span class="hljs-string">&quot;alpha&quot;</span>, <span class="hljs-number">1</span>);
    s.beta = option_find_float_quiet(options, <span class="hljs-string">&quot;beta&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> s;
}
</code></pre>
<ul>
<li>shortcut layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parsel2norm">parse_l2norm</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_l2norm</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    layer l = make_l2norm_layer(params.batch, params.inputs);
    l.h = l.out_h = params.h;
    l.w = l.out_w = params.w;
    l.c = l.out_c = params.c;
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>l2norm layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parselogistic">parse_logistic</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_logistic</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    layer l = make_logistic_layer(params.batch, params.inputs);
    l.h = l.out_h = params.h;
    l.w = l.out_w = params.w;
    l.c = l.out_c = params.c;
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>logistic layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseactivation">parse_activation</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_activation</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params)</span>
</span>{
    <span class="hljs-keyword">char</span> *activation_s = option_find_str(options, <span class="hljs-string">&quot;activation&quot;</span>, <span class="hljs-string">&quot;linear&quot;</span>);
    ACTIVATION activation = get_activation(activation_s);

    layer l = make_activation_layer(params.batch, params.inputs, activation);

    l.h = l.out_h = params.h;
    l.w = l.out_w = params.w;
    l.c = l.out_c = params.c;

    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>activation layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseupsample">parse_upsample</h2>
<pre><code class="lang-c"><span class="hljs-function">layer <span class="hljs-title">parse_upsample</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params, network *net)</span>
</span>{

    <span class="hljs-keyword">int</span> stride = option_find_int(options, <span class="hljs-string">&quot;stride&quot;</span>,<span class="hljs-number">2</span>);
    layer l = make_upsample_layer(params.batch, params.w, params.h, params.c, stride);
    l.scale = option_find_float_quiet(options, <span class="hljs-string">&quot;scale&quot;</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> l;
}
</code></pre>
<ul>
<li>upsampling layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="parseroute">parse_route</h2>
<pre><code class="lang-c"><span class="hljs-function">route_layer <span class="hljs-title">parse_route</span><span class="hljs-params">(<span class="hljs-built_in">list</span> *options, size_params params, network *net)</span>
</span>{
    <span class="hljs-keyword">char</span> *l = option_find(options, <span class="hljs-string">&quot;layers&quot;</span>);
    <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">strlen</span>(l);
    <span class="hljs-keyword">if</span>(!l) error(<span class="hljs-string">&quot;Route Layer must specify input layers&quot;</span>);
    <span class="hljs-keyword">int</span> n = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; len; ++i){
        <span class="hljs-keyword">if</span> (l[i] == <span class="hljs-string">&apos;,&apos;</span>) ++n;
    }

    <span class="hljs-keyword">int</span> *layers = <span class="hljs-built_in">calloc</span>(n, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));
    <span class="hljs-keyword">int</span> *sizes = <span class="hljs-built_in">calloc</span>(n, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; n; ++i){
        <span class="hljs-keyword">int</span> index = atoi(l);
        l = <span class="hljs-built_in">strchr</span>(l, <span class="hljs-string">&apos;,&apos;</span>)+<span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span>(index &lt; <span class="hljs-number">0</span>) index = params.index + index;
        layers[i] = index;
        sizes[i] = net-&gt;layers[index].outputs;
    }
    <span class="hljs-keyword">int</span> batch = params.batch;

    route_layer layer = make_route_layer(batch, n, layers, sizes);

    convolutional_layer first = net-&gt;layers[layers[<span class="hljs-number">0</span>]];
    layer.out_w = first.out_w;
    layer.out_h = first.out_h;
    layer.out_c = first.out_c;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">1</span>; i &lt; n; ++i){
        <span class="hljs-keyword">int</span> index = layers[i];
        convolutional_layer next = net-&gt;layers[index];
        <span class="hljs-keyword">if</span>(next.out_w == first.out_w &amp;&amp; next.out_h == first.out_h){
            layer.out_c += next.out_c;
        }<span class="hljs-keyword">else</span>{
            layer.out_h = layer.out_w = layer.out_c = <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-keyword">return</span> layer;
}
</code></pre>
<ul>
<li>route layer&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB4E4;&#xC744; parsing&#xD574;&#xC11C; layer&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="getpolicy">get_policy</h2>
<pre><code class="lang-c"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> {
    CONSTANT, STEP, EXP, POLY, STEPS, SIG, RANDOM
} learning_rate_policy;

<span class="hljs-function">learning_rate_policy <span class="hljs-title">get_policy</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s)</span>
</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(s, <span class="hljs-string">&quot;random&quot;</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> RANDOM;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(s, <span class="hljs-string">&quot;poly&quot;</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> POLY;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(s, <span class="hljs-string">&quot;constant&quot;</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> CONSTANT;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(s, <span class="hljs-string">&quot;step&quot;</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> STEP;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(s, <span class="hljs-string">&quot;exp&quot;</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> EXP;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(s, <span class="hljs-string">&quot;sigmoid&quot;</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> SIG;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(s, <span class="hljs-string">&quot;steps&quot;</span>)==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> STEPS;
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Couldn&apos;t find policy %s, going with constant\n&quot;</span>, s);
    <span class="hljs-keyword">return</span> CONSTANT;
}
</code></pre>
<ul>
<li>learning rate scheduler&#xC5D0; &#xD574;&#xB2F9;&#xD558;&#xB294; &#xAC12;&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="isnetwork">is_network</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">is_network</span><span class="hljs-params">(section *s)</span>
</span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">strcmp</span>(s-&gt;type, <span class="hljs-string">&quot;[net]&quot;</span>)==<span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(s-&gt;type, <span class="hljs-string">&quot;[network]&quot;</span>)==<span class="hljs-number">0</span>);
}
</code></pre>
<ul>
<li>&#xB124;&#xD2B8;&#xC6CC;&#xD06C;&#xC778;&#xC9C0; &#xC544;&#xB2CC;&#xC9C0; &#xD655;&#xC778;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="loadweights">load_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">load_weights</span><span class="hljs-params">(network *net, <span class="hljs-keyword">char</span> *filename)</span>
</span>{
    load_weights_upto(net, filename, <span class="hljs-number">0</span>, net-&gt;n);
}
</code></pre>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">load_weights_upto</span><span class="hljs-params">(network *net, <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> cutoff)</span>
</span>{
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Loading weights from %s...&quot;</span>, filename);
    fflush(<span class="hljs-built_in">stdout</span>);
    FILE *fp = fopen(filename, <span class="hljs-string">&quot;rb&quot;</span>);
    <span class="hljs-keyword">if</span>(!fp) file_error(filename);

    <span class="hljs-keyword">int</span> major;
    <span class="hljs-keyword">int</span> minor;
    <span class="hljs-keyword">int</span> revision;
    fread(&amp;major, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), <span class="hljs-number">1</span>, fp);
    fread(&amp;minor, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), <span class="hljs-number">1</span>, fp);
    fread(&amp;revision, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), <span class="hljs-number">1</span>, fp);
    <span class="hljs-keyword">if</span> ((major*<span class="hljs-number">10</span> + minor) &gt;= <span class="hljs-number">2</span> &amp;&amp; major &lt; <span class="hljs-number">1000</span> &amp;&amp; minor &lt; <span class="hljs-number">1000</span>){
        fread(net-&gt;seen, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">size_t</span>), <span class="hljs-number">1</span>, fp);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">int</span> iseen = <span class="hljs-number">0</span>;
        fread(&amp;iseen, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), <span class="hljs-number">1</span>, fp);
        *net-&gt;seen = iseen;
    }
    <span class="hljs-keyword">int</span> transpose = (major &gt; <span class="hljs-number">1000</span>) || (minor &gt; <span class="hljs-number">1000</span>);

    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = start; i &lt; net-&gt;n &amp;&amp; i &lt; cutoff; ++i){
        layer l = net-&gt;layers[i];
        <span class="hljs-keyword">if</span> (l.dontload) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span>(l.type == CONVOLUTIONAL || l.type == DECONVOLUTIONAL){
            load_convolutional_weights(l, fp);
        }
        <span class="hljs-keyword">if</span>(l.type == CONNECTED){
            load_connected_weights(l, fp, transpose);
        }
        <span class="hljs-keyword">if</span>(l.type == BATCHNORM){
            load_batchnorm_weights(l, fp);
        }
        <span class="hljs-keyword">if</span>(l.type == CRNN){
            load_convolutional_weights(*(l.input_layer), fp);
            load_convolutional_weights(*(l.self_layer), fp);
            load_convolutional_weights(*(l.output_layer), fp);
        }
        <span class="hljs-keyword">if</span>(l.type == RNN){
            load_connected_weights(*(l.input_layer), fp, transpose);
            load_connected_weights(*(l.self_layer), fp, transpose);
            load_connected_weights(*(l.output_layer), fp, transpose);
        }
        <span class="hljs-keyword">if</span> (l.type == LSTM) {
            load_connected_weights(*(l.wi), fp, transpose);
            load_connected_weights(*(l.wf), fp, transpose);
            load_connected_weights(*(l.wo), fp, transpose);
            load_connected_weights(*(l.wg), fp, transpose);
            load_connected_weights(*(l.ui), fp, transpose);
            load_connected_weights(*(l.uf), fp, transpose);
            load_connected_weights(*(l.uo), fp, transpose);
            load_connected_weights(*(l.ug), fp, transpose);
        }
        <span class="hljs-keyword">if</span> (l.type == GRU) {
            <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>){
                load_connected_weights(*(l.wz), fp, transpose);
                load_connected_weights(*(l.wr), fp, transpose);
                load_connected_weights(*(l.wh), fp, transpose);
                load_connected_weights(*(l.uz), fp, transpose);
                load_connected_weights(*(l.ur), fp, transpose);
                load_connected_weights(*(l.uh), fp, transpose);
            }<span class="hljs-keyword">else</span>{
                load_connected_weights(*(l.reset_layer), fp, transpose);
                load_connected_weights(*(l.update_layer), fp, transpose);
                load_connected_weights(*(l.state_layer), fp, transpose);
            }
        }
        <span class="hljs-keyword">if</span>(l.type == LOCAL){
            <span class="hljs-keyword">int</span> locations = l.out_w*l.out_h;
            <span class="hljs-keyword">int</span> size = l.size*l.size*l.c*l.n*locations;
            fread(l.biases, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
            fread(l.weights, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), size, fp);
        }
    }
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Done!\n&quot;</span>);
    fclose(fp);
}
</code></pre>
<ul>
<li>weights &#xD30C;&#xC77C;&#xC744; &#xBD88;&#xB7EC;&#xC624;&#xACE0; &#xAC01; Layer&#xC758; &#xD574;&#xB2F9;&#xB418;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB97C; &#xB123;&#xC2B5;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="loadconvolutionalweights">load_convolutional_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">load_convolutional_weights</span><span class="hljs-params">(layer l, FILE *fp)</span>
</span>{
    <span class="hljs-keyword">if</span>(l.binary){
        <span class="hljs-comment">//load_convolutional_weights_binary(l, fp);</span>
        <span class="hljs-comment">//return;</span>
    }
    <span class="hljs-keyword">if</span>(l.numload) l.n = l.numload;
    <span class="hljs-keyword">int</span> num = l.c/l.groups*l.n*l.size*l.size;
    fread(l.biases, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
    <span class="hljs-keyword">if</span> (l.batch_normalize &amp;&amp; (!l.dontloadscales)){
        fread(l.scales, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
        fread(l.rolling_mean, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
        fread(l.rolling_variance, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
        <span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>){
            <span class="hljs-keyword">int</span> i;
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; l.n; ++i){
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%g, &quot;</span>, l.rolling_mean[i]);
            }
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; l.n; ++i){
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%g, &quot;</span>, l.rolling_variance[i]);
            }
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>){
            fill_cpu(l.n, <span class="hljs-number">0</span>, l.rolling_mean, <span class="hljs-number">1</span>);
            fill_cpu(l.n, <span class="hljs-number">0</span>, l.rolling_variance, <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>){
            <span class="hljs-keyword">int</span> i;
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; l.n; ++i){
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%g, &quot;</span>, l.rolling_mean[i]);
            }
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; l.n; ++i){
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%g, &quot;</span>, l.rolling_variance[i]);
            }
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
        }
    }
    fread(l.weights, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), num, fp);
    <span class="hljs-comment">//if(l.c == 3) scal_cpu(num, 1./256, l.weights, 1);</span>
    <span class="hljs-keyword">if</span> (l.flipped) {
        transpose_matrix(l.weights, l.c*l.size*l.size, l.n);
    }
    <span class="hljs-comment">//if (l.binary) binarize_weights(l.weights, l.n, l.c*l.size*l.size, l.weights);</span>
}
</code></pre>
<ul>
<li>convolution layer&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xBAA8;&#xB4E0; weights&#xB97C; &#xBD88;&#xB7EC;&#xC635;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="loadbatchnormweights">load_batchnorm_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">load_batchnorm_weights</span><span class="hljs-params">(layer l, FILE *fp)</span>
</span>{
    fread(l.scales, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.c, fp);
    fread(l.rolling_mean, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.c, fp);
    fread(l.rolling_variance, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.c, fp);
}
</code></pre>
<ul>
<li>batch normalization&#xC5D0;&#xC11C; &#xCD94;&#xB860;&#xC5D0; &#xD544;&#xC694;&#xD55C; rolling mean, rolling variance&#xB97C; &#xBD88;&#xB7EC;&#xC635;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="loadconnectedweights">load_connected_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">load_connected_weights</span><span class="hljs-params">(layer l, FILE *fp, <span class="hljs-keyword">int</span> transpose)</span>
</span>{
    fread(l.biases, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
    fread(l.weights, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs*l.inputs, fp);
    <span class="hljs-keyword">if</span>(transpose){
        transpose_matrix(l.weights, l.inputs, l.outputs);
    }
    <span class="hljs-comment">//printf(&quot;Biases: %f mean %f variance\n&quot;, mean_array(l.biases, l.outputs), variance_array(l.biases, l.outputs));</span>
    <span class="hljs-comment">//printf(&quot;Weights: %f mean %f variance\n&quot;, mean_array(l.weights, l.outputs*l.inputs), variance_array(l.weights, l.outputs*l.inputs));</span>
    <span class="hljs-keyword">if</span> (l.batch_normalize &amp;&amp; (!l.dontloadscales)){
        fread(l.scales, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
        fread(l.rolling_mean, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
        fread(l.rolling_variance, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
        <span class="hljs-comment">//printf(&quot;Scales: %f mean %f variance\n&quot;, mean_array(l.scales, l.outputs), variance_array(l.scales, l.outputs));</span>
        <span class="hljs-comment">//printf(&quot;rolling_mean: %f mean %f variance\n&quot;, mean_array(l.rolling_mean, l.outputs), variance_array(l.rolling_mean, l.outputs));</span>
        <span class="hljs-comment">//printf(&quot;rolling_variance: %f mean %f variance\n&quot;, mean_array(l.rolling_variance, l.outputs), variance_array(l.rolling_variance, l.outputs));</span>
    }
}
</code></pre>
<ul>
<li>fully connected layer&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xBAA8;&#xB4E0; weights&#xB97C; &#xBD88;&#xB7EC;&#xC635;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="transposematrix">transpose_matrix</h2>
<pre><code class="lang-c">void transpose_matrix(float *a, int rows, int cols)
{
    float *transpose = calloc(rows*cols, sizeof(float));
    int x, y;
    for(x = 0; x &lt; rows; ++x){
        for(y = 0; y &lt; cols; ++y){
            transpose[y*rows + x] = a[x*cols + y];
        }
    }
    memcpy(a, transpose, rows*cols*sizeof(float));
    free(transpose);
}
</code></pre>
<ul>
<li>&#xD589;&#xB82C;&#xC744; &#xC804;&#xCE58; &#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li>
</ul>
<pre><code>-------------                   -------------
| 1 | 2 | 3 |                   | 1 | 4 | 7 |
-------------                   -------------
| 4 | 5 | 6 |        -&gt;         | 2 | 5 | 8 |
-------------                   -------------
| 7 | 8 | 9 |                   | 3 | 6 | 9 |
-------------                   -------------
</code></pre><h2 id="saveweights">save_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save_weights</span><span class="hljs-params">(network *net, <span class="hljs-keyword">char</span> *filename)</span>
</span>{
    save_weights_upto(net, filename, net-&gt;n);
}
</code></pre>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save_weights_upto</span><span class="hljs-params">(network *net, <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">int</span> cutoff)</span>
</span>{
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Saving weights to %s\n&quot;</span>, filename);
    FILE *fp = fopen(filename, <span class="hljs-string">&quot;wb&quot;</span>);
    <span class="hljs-keyword">if</span>(!fp) file_error(filename);

    <span class="hljs-keyword">int</span> major = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> minor = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">int</span> revision = <span class="hljs-number">0</span>;
    fwrite(&amp;major, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), <span class="hljs-number">1</span>, fp);
    fwrite(&amp;minor, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), <span class="hljs-number">1</span>, fp);
    fwrite(&amp;revision, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), <span class="hljs-number">1</span>, fp);
    fwrite(net-&gt;seen, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">size_t</span>), <span class="hljs-number">1</span>, fp);

    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; net-&gt;n &amp;&amp; i &lt; cutoff; ++i){
        layer l = net-&gt;layers[i];
        <span class="hljs-keyword">if</span> (l.dontsave) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span>(l.type == CONVOLUTIONAL || l.type == DECONVOLUTIONAL){
            save_convolutional_weights(l, fp);
        } <span class="hljs-keyword">if</span>(l.type == CONNECTED){
            save_connected_weights(l, fp);
        } <span class="hljs-keyword">if</span>(l.type == BATCHNORM){
            save_batchnorm_weights(l, fp);
        } <span class="hljs-keyword">if</span>(l.type == RNN){
            save_connected_weights(*(l.input_layer), fp);
            save_connected_weights(*(l.self_layer), fp);
            save_connected_weights(*(l.output_layer), fp);
        } <span class="hljs-keyword">if</span> (l.type == LSTM) {
            save_connected_weights(*(l.wi), fp);
            save_connected_weights(*(l.wf), fp);
            save_connected_weights(*(l.wo), fp);
            save_connected_weights(*(l.wg), fp);
            save_connected_weights(*(l.ui), fp);
            save_connected_weights(*(l.uf), fp);
            save_connected_weights(*(l.uo), fp);
            save_connected_weights(*(l.ug), fp);
        } <span class="hljs-keyword">if</span> (l.type == GRU) {
            <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>){
                save_connected_weights(*(l.wz), fp);
                save_connected_weights(*(l.wr), fp);
                save_connected_weights(*(l.wh), fp);
                save_connected_weights(*(l.uz), fp);
                save_connected_weights(*(l.ur), fp);
                save_connected_weights(*(l.uh), fp);
            }<span class="hljs-keyword">else</span>{
                save_connected_weights(*(l.reset_layer), fp);
                save_connected_weights(*(l.update_layer), fp);
                save_connected_weights(*(l.state_layer), fp);
            }
        }  <span class="hljs-keyword">if</span>(l.type == CRNN){
            save_convolutional_weights(*(l.input_layer), fp);
            save_convolutional_weights(*(l.self_layer), fp);
            save_convolutional_weights(*(l.output_layer), fp);
        } <span class="hljs-keyword">if</span>(l.type == LOCAL){
            <span class="hljs-keyword">int</span> locations = l.out_w*l.out_h;
            <span class="hljs-keyword">int</span> size = l.size*l.size*l.c*l.n*locations;
            fwrite(l.biases, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
            fwrite(l.weights, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), size, fp);
        }
    }
    fclose(fp);
}
</code></pre>
<ul>
<li>&#xAC01; Layer&#xC758; &#xD574;&#xB2F9;&#xB418;&#xB294; &#xD30C;&#xB77C;&#xBBF8;&#xD130;&#xB97C; weights &#xD30C;&#xC77C;&#xB85C;&#xC368; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="saveconnectedweights">save_connected_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save_connected_weights</span><span class="hljs-params">(layer l, FILE *fp)</span>
</span>{
    fwrite(l.biases, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
    fwrite(l.weights, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs*l.inputs, fp);
    <span class="hljs-keyword">if</span> (l.batch_normalize){
        fwrite(l.scales, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
        fwrite(l.rolling_mean, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
        fwrite(l.rolling_variance, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.outputs, fp);
    }
}
</code></pre>
<ul>
<li>fully connected layer&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xBAA8;&#xB4E0; weights&#xB97C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="savebatchnormweights">save_batchnorm_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save_batchnorm_weights</span><span class="hljs-params">(layer l, FILE *fp)</span>
</span>{
    fwrite(l.scales, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.c, fp);
    fwrite(l.rolling_mean, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.c, fp);
    fwrite(l.rolling_variance, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.c, fp);
}
</code></pre>
<ul>
<li>batch normalization&#xC5D0;&#xC11C; &#xCD94;&#xB860;&#xC5D0; &#xD544;&#xC694;&#xD55C; rolling mean, rolling variance&#xB97C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="saveconvolutionalweights">save_convolutional_weights</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save_convolutional_weights</span><span class="hljs-params">(layer l, FILE *fp)</span>
</span>{
    <span class="hljs-keyword">if</span>(l.binary){
        <span class="hljs-comment">//save_convolutional_weights_binary(l, fp);</span>
        <span class="hljs-comment">//return;</span>
    }

    <span class="hljs-keyword">int</span> num = l.nweights;
    fwrite(l.biases, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
    <span class="hljs-keyword">if</span> (l.batch_normalize){
        fwrite(l.scales, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
        fwrite(l.rolling_mean, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
        fwrite(l.rolling_variance, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), l.n, fp);
    }
    fwrite(l.weights, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>), num, fp);
}
</code></pre>
<ul>
<li>convolutional layer&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xBAA8;&#xB4E0; weights&#xB97C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="parser_1.html" class="navigation navigation-prev " aria-label="Previous page: parser.c">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="region_layer.html" class="navigation navigation-next " aria-label="Next page: region_layer.c">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"+ parser.c","level":"5.35.1","depth":2,"next":{"title":"region_layer.c","level":"5.36","depth":1,"path":"part3_src/region_layer.md","ref":"part3_src/region_layer.md","articles":[]},"previous":{"title":"parser.c","level":"5.35","depth":1,"path":"part3_src/parser_1.md","ref":"part3_src/parser_1.md","articles":[{"title":"+ parser.c","level":"5.35.1","depth":2,"path":"part3_src/parser_2.md","ref":"part3_src/parser_2.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["advanced-emoji","theme-gestalt","-theme-default","styles-sass-fix","theme-api","mathjax","ga"],"root":"./","styles":{"website":"website-1608524487893.css"},"pluginsConfig":{"styles-sass-fix":{},"theme-gestalt":{"showLevel":false,"styles":{"website":"styles/website.css"},"logo":"/darknet_book/assets/darknet.png","baseUrl":null,"excludeDefaultStyles":true,"doNotHideChildrenChapters":false},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"theme-api":{"languages":[],"split":true,"theme":"light"},"mathjax":{"forceSVG":false,"version":"2.6-latest"},"ga":{"configuration":"auto","token":"UA-136921229-1"},"advanced-emoji":{"embedEmojis":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]}},"theme":"default","author":"JJM","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"BASE_URL":"https://jjeamin.github.io"},"title":"DarkNet Book","output.name":"site","gitbook":"*"},"file":{"path":"part3_src/parser_2.md","mtime":"2020-09-15T15:24:47.876Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-21T04:21:22.548Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

