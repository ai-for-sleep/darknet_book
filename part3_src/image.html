
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>image.c · DarkNet Book</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="JJM">
        
        
    
    

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../website-1599634348142.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
    
    
    

    
    <link rel="next" href="iseg_layer.html" />
    
    
    <link rel="prev" href="im2col.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            <div class="book-logo">   
                
                <img src="/darknet_book/assets/darknet.png"/>
                
            </div>
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
        <li class="header ">DARKNET</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="1.1" 
            data-path="../">

            
                <a href="../">
            
                    
                    DarkNet
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="1.2" 
            data-path="../INSTALL.html">

            
                <a href="../INSTALL.html">
            
                    
                    설치하기
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">Paper</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="2.1" 
            data-path="../part1_paper/yolov1.html">

            
                <a href="../part1_paper/yolov1.html">
            
                    
                    YOLOv1
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="2.2" 
            data-path="../part1_paper/yolov2.html">

            
                <a href="../part1_paper/yolov2.html">
            
                    
                    YOLOv2
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="2.3" 
            data-path="../part1_paper/yolov3.html">

            
                <a href="../part1_paper/yolov3.html">
            
                    
                    YOLOv3
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="2.4" 
            data-path="../part1_paper/yolov4.html">

            
                <a href="../part1_paper/yolov4.html">
            
                    
                    YOLOv4
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">SOURCE</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="3.1" 
            data-path="../part2_source/0_Project.html">

            
                <a href="../part2_source/0_Project.html">
            
                    
                    project
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.2" 
            data-path="../part2_source/1_DATA.html">

            
                <a href="../part2_source/1_DATA.html">
            
                    
                    /data
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.3" 
            data-path="../part2_source/2_CFG.html">

            
                <a href="../part2_source/2_CFG.html">
            
                    
                    /cfg
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.4" 
            data-path="../part2_source/3_EXAMPLE.html">

            
                <a href="../part2_source/3_EXAMPLE.html">
            
                    
                    /example
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="3.5" 
            data-path="../part2_source/4_SRC.html">

            
                <a href="../part2_source/4_SRC.html">
            
                    
                    /src
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">Structure</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="4.1" 
            data-path="../part4_structure/network.html">

            
                <a href="../part4_structure/network.html">
            
                    
                    network
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="4.2" 
            data-path="../part4_structure/layer.html">

            
                <a href="../part4_structure/layer.html">
            
                    
                    layer
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="4.3" 
            data-path="../part4_structure/etc.html">

            
                <a href="../part4_structure/etc.html">
            
                    
                    etc
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header  selected ">/SRC</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="5.1" 
            data-path="activation_layer.html">

            
                <a href="activation_layer.html">
            
                    
                    activation_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.2" 
            data-path="activations_1.html">

            
                <a href="activations_1.html">
            
                    
                    activations.c
            
                </a>
            

            
            <ul class="articles">
                
                
    
        
        <li class="chapter 
               hide "
            data-level="5.2.1" 
            data-path="activations_2.html">

            
                <a href="activations_2.html">
            
                    
                    activation.h
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.3" 
            data-path="avgpool.html">

            
                <a href="avgpool.html">
            
                    
                    avgpool_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.4" 
            data-path="batchnorm_layer.html">

            
                <a href="batchnorm_layer.html">
            
                    
                    batchnorm_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.5" 
            data-path="blas.html">

            
                <a href="blas.html">
            
                    
                    blas.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.6" 
            data-path="box.html">

            
                <a href="box.html">
            
                    
                    box.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.7" 
            data-path="col2im.html">

            
                <a href="col2im.html">
            
                    
                    col2im.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.8" 
            data-path="compare.html">

            
                <a href="compare.html">
            
                    
                    compare.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.9" 
            data-path="connected_layer.html">

            
                <a href="connected_layer.html">
            
                    
                    connected_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.10" 
            data-path="convolutional_layer.html">

            
                <a href="convolutional_layer.html">
            
                    
                    convolutional_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.11" 
            data-path="cost_layer.html">

            
                <a href="cost_layer.html">
            
                    
                    cost_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.12" 
            data-path="crnn_layer.html">

            
                <a href="crnn_layer.html">
            
                    
                    crnn_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.13" 
            data-path="crop_layer.html">

            
                <a href="crop_layer.html">
            
                    
                    crop_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.14" 
            data-path="data.html">

            
                <a href="data.html">
            
                    
                    data.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.15" 
            data-path="deconvolutional_layer.html">

            
                <a href="deconvolutional_layer.html">
            
                    
                    deconvolutional_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.16" 
            data-path="demo.html">

            
                <a href="demo.html">
            
                    
                    demo.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.17" 
            data-path="detection_layer.html">

            
                <a href="detection_layer.html">
            
                    
                    detection_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.18" 
            data-path="dropout_layer.html">

            
                <a href="dropout_layer.html">
            
                    
                    dropout_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.19" 
            data-path="gemm.html">

            
                <a href="gemm.html">
            
                    
                    gemm.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.20" 
            data-path="gru_layer.html">

            
                <a href="gru_layer.html">
            
                    
                    gru_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.21" 
            data-path="im2col.html">

            
                <a href="im2col.html">
            
                    
                    im2col.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
            active  selected  "
            data-level="5.22" 
            data-path="image.html">

            
                <a href="image.html">
            
                    
                    image.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.23" 
            data-path="iseg_layer.html">

            
                <a href="iseg_layer.html">
            
                    
                    iseg_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.24" 
            data-path="l2norm_layer.html">

            
                <a href="l2norm_layer.html">
            
                    
                    l2norm_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.25" 
            data-path="layer.html">

            
                <a href="layer.html">
            
                    
                    layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.26" 
            data-path="list.html">

            
                <a href="list.html">
            
                    
                    list.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.27" 
            data-path="local_layer.html">

            
                <a href="local_layer.html">
            
                    
                    local_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.28" 
            data-path="logistic_layer.html">

            
                <a href="logistic_layer.html">
            
                    
                    logistic_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.29" 
            data-path="lstm_layer.html">

            
                <a href="lstm_layer.html">
            
                    
                    lstm_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.30" 
            data-path="matrix.html">

            
                <a href="matrix.html">
            
                    
                    matrix.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.31" 
            data-path="maxpool.html">

            
                <a href="maxpool.html">
            
                    
                    maxpool_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.32" 
            data-path="network.html">

            
                <a href="network.html">
            
                    
                    network.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.33" 
            data-path="normalization_layer.html">

            
                <a href="normalization_layer.html">
            
                    
                    normalization_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.34" 
            data-path="option_list.html">

            
                <a href="option_list.html">
            
                    
                    option_list.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.35" 
            data-path="parser_1.html">

            
                <a href="parser_1.html">
            
                    
                    parser.c
            
                </a>
            

            
            <ul class="articles">
                
                
    
        
        <li class="chapter 
               hide "
            data-level="5.35.1" 
            data-path="parser_2.html">

            
                <a href="parser_2.html">
            
                    
                    + parser.c
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.36" 
            data-path="region_layer.html">

            
                <a href="region_layer.html">
            
                    
                    region_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.37" 
            data-path="reorg_layer.html">

            
                <a href="reorg_layer.html">
            
                    
                    reorg_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.38" 
            data-path="rnn_layer.html">

            
                <a href="rnn_layer.html">
            
                    
                    rnn_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.39" 
            data-path="route_layer.html">

            
                <a href="route_layer.html">
            
                    
                    route_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.40" 
            data-path="shortcut.md">

            
                <span>
            
                    
                    shortcut_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.41" 
            data-path="softmax_layer.html">

            
                <a href="softmax_layer.html">
            
                    
                    softmax_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.42" 
            data-path="tree.html">

            
                <a href="tree.html">
            
                    
                    tree.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.43" 
            data-path="upsample_layer.html">

            
                <a href="upsample_layer.html">
            
                    
                    upsample_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.44" 
            data-path="utils.html">

            
                <a href="utils.html">
            
                    
                    utils.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.45" 
            data-path="yolo_layer.html">

            
                <a href="yolo_layer.html">
            
                    
                    yolo_layer.c
            
                </a>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="5.46" 
            data-path="image_opencv.html">

            
                <a href="image_opencv.html">
            
                    
                    image_opencv.cpp
            
                </a>
            

            
        </li>
    

    
        
        
        <li class="header ">CUDA</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="6.1" 
            >

            
                <span>
            
                    
                    cuda.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.2" 
            >

            
                <span>
            
                    
                    avgpool_layer_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.3" 
            >

            
                <span>
            
                    
                    maxpool_layer_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.4" 
            >

            
                <span>
            
                    
                    im2col_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.5" 
            >

            
                <span>
            
                    
                    blas_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.6" 
            >

            
                <span>
            
                    
                    activation_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.7" 
            >

            
                <span>
            
                    
                    col2im_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.8" 
            >

            
                <span>
            
                    
                    convolutional_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.9" 
            >

            
                <span>
            
                    
                    crop_layer_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.10" 
            >

            
                <span>
            
                    
                    deconvolutional_kernels.cu
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="6.11" 
            >

            
                <span>
            
                    
                    dropout_layer_kernels.cu
            
                </span>
            

            
        </li>
    

    
        
        
        <li class="header ">/example</li>
        
        
    
        
        <li class="chapter 
              "
            data-level="7.1" 
            >

            
                <span>
            
                    
                    art.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.2" 
            >

            
                <span>
            
                    
                    attention.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.3" 
            >

            
                <span>
            
                    
                    captcha.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.4" 
            >

            
                <span>
            
                    
                    cifar.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.5" 
            >

            
                <span>
            
                    
                    classifier.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.6" 
            >

            
                <span>
            
                    
                    coco.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.7" 
            >

            
                <span>
            
                    
                    darknet.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.8" 
            >

            
                <span>
            
                    
                    detector-scipy-opencv.py
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.9" 
            >

            
                <span>
            
                    
                    detector.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.10" 
            >

            
                <span>
            
                    
                    detector.py
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.11" 
            >

            
                <span>
            
                    
                    dice.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.12" 
            >

            
                <span>
            
                    
                    go.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.13" 
            >

            
                <span>
            
                    
                    instance-segmenter.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.14" 
            >

            
                <span>
            
                    
                    lsd.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.15" 
            >

            
                <span>
            
                    
                    nightmare.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.16" 
            >

            
                <span>
            
                    
                    regressor.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.17" 
            >

            
                <span>
            
                    
                    rnn.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.18" 
            >

            
                <span>
            
                    
                    rnn_vid.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.19" 
            >

            
                <span>
            
                    
                    segmenter.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.20" 
            >

            
                <span>
            
                    
                    super.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.21" 
            >

            
                <span>
            
                    
                    swag.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.22" 
            >

            
                <span>
            
                    
                    tag.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.23" 
            >

            
                <span>
            
                    
                    voxel.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.24" 
            >

            
                <span>
            
                    
                    writing.c
            
                </span>
            

            
        </li>
    
        
        <li class="chapter 
              "
            data-level="7.25" 
            >

            
                <span>
            
                    
                    yolo.c
            
                </span>
            

            
        </li>
    

    
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >image.c</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="imagec">image.c</h1>
<h2 id="getcolor">get_color</h2>
<pre><code class="lang-c"><span class="hljs-keyword">float</span> colors[<span class="hljs-number">6</span>][<span class="hljs-number">3</span>] = { {<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>}, {<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>},{<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>},{<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>},{<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>},{<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>} }; <span class="hljs-comment">// BGR&#xC21C;&#xC11C;</span>


<span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">get_color</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> max)</span>
</span>{
    <span class="hljs-keyword">float</span> ratio = ((<span class="hljs-keyword">float</span>)x/max)*<span class="hljs-number">5</span>;
    <span class="hljs-keyword">int</span> i = <span class="hljs-built_in">floor</span>(ratio);
    <span class="hljs-keyword">int</span> j = <span class="hljs-built_in">ceil</span>(ratio);
    ratio -= i;
    <span class="hljs-keyword">float</span> r = (<span class="hljs-number">1</span>-ratio) * colors[i][c] + ratio*colors[j][c];
    <span class="hljs-comment">//printf(&quot;%f\n&quot;, r);</span>
    <span class="hljs-keyword">return</span> r;
}
</code></pre>
<ul>
<li>&#xC0C9;&#xC744; &#xC5BB;&#xC2B5;&#xB2C8;&#xB2E4;.</li>
<li>++</li>
</ul>
<h2 id="masktorgb">mask_to_rgb</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">mask_to_rgb</span><span class="hljs-params">(image mask)</span>
</span>{
    <span class="hljs-keyword">int</span> n = mask.c;
    image im = make_image(mask.w, mask.h, <span class="hljs-number">3</span>);
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; n; ++j){
        <span class="hljs-keyword">int</span> offset = j*<span class="hljs-number">123457</span> % n;
        <span class="hljs-keyword">float</span> red = get_color(<span class="hljs-number">2</span>,offset,n);
        <span class="hljs-keyword">float</span> green = get_color(<span class="hljs-number">1</span>,offset,n);
        <span class="hljs-keyword">float</span> blue = get_color(<span class="hljs-number">0</span>,offset,n);
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w*im.h; ++i){
            im.data[i + <span class="hljs-number">0</span>*im.w*im.h] += mask.data[j*im.h*im.w + i]*red;
            im.data[i + <span class="hljs-number">1</span>*im.w*im.h] += mask.data[j*im.h*im.w + i]*green;
            im.data[i + <span class="hljs-number">2</span>*im.w*im.h] += mask.data[j*im.h*im.w + i]*blue;
        }
    }
    <span class="hljs-keyword">return</span> im;
}
</code></pre>
<ul>
<li>image&#xC5D0; rgb color&#xB97C; &#xC90D;&#xB2C8;&#xB2E4;.</li>
<li>++</li>
</ul>
<h2 id="getpixel">get_pixel</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">float</span> <span class="hljs-title">get_pixel</span><span class="hljs-params">(image m, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> c)</span>
</span>{
    assert(x &lt; m.w &amp;&amp; y &lt; m.h &amp;&amp; c &lt; m.c);
    <span class="hljs-keyword">return</span> m.data[c*m.h*m.w + y*m.w + x];
}
</code></pre>
<ul>
<li>c&#xBC88;&#xC9F8; &#xCC44;&#xB110;&#xC758; (x, y)&#xC88C;&#xD45C;&#xB97C; &#xAC00;&#xC9C0;&#xB294; pixel&#xC744; &#xAC00;&#xC838;&#xC635;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="getpixelextend">get_pixel_extend</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">float</span> <span class="hljs-title">get_pixel_extend</span><span class="hljs-params">(image m, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> c)</span>
</span>{
    <span class="hljs-keyword">if</span>(x &lt; <span class="hljs-number">0</span> || x &gt;= m.w || y &lt; <span class="hljs-number">0</span> || y &gt;= m.h) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span>(c &lt; <span class="hljs-number">0</span> || c &gt;= m.c) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> get_pixel(m, x, y, c);
}
</code></pre>
<ul>
<li>&#xAC00;&#xC838;&#xC62C; &#xC218; &#xC5C6;&#xB294; pixel&#xC744; 0&#xC73C;&#xB85C; &#xCC98;&#xB9AC;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="setpixel">set_pixel</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set_pixel</span><span class="hljs-params">(image m, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">float</span> val)</span>
</span>{
    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span> || c &lt; <span class="hljs-number">0</span> || x &gt;= m.w || y &gt;= m.h || c &gt;= m.c) <span class="hljs-keyword">return</span>;
    assert(x &lt; m.w &amp;&amp; y &lt; m.h &amp;&amp; c &lt; m.c);
    m.data[c*m.h*m.w + y*m.w + x] = val;
}
</code></pre>
<ul>
<li>c&#xBC88;&#xC9F8; &#xCC44;&#xB110;&#xC758; (x, y)&#xC88C;&#xD45C;&#xB97C; &#xAC00;&#xC9C0;&#xB294; pixel&#xC744; val&#xB85C; &#xC124;&#xC815;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="addpixel">add_pixel</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add_pixel</span><span class="hljs-params">(image m, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">float</span> val)</span>
</span>{
    assert(x &lt; m.w &amp;&amp; y &lt; m.h &amp;&amp; c &lt; m.c);
    m.data[c*m.h*m.w + y*m.w + x] += val;
}
</code></pre>
<ul>
<li>c&#xBC88;&#xC9F8; &#xCC44;&#xB110;&#xC758; (x, y)&#xC88C;&#xD45C;&#xB97C; &#xAC00;&#xC9C0;&#xB294; pixel&#xC5D0; add&#xB97C; &#xB354;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="bilinearinterpolate">bilinear_interpolate</h2>
<pre><code class="lang-c">static float bilinear_interpolate(image im, float x, float y, int c)
{
    int ix = (int) floorf(x);
    int iy = (int) floorf(y);

    float dx = x - ix;
    float dy = y - iy;

    float val = (1-dy) * (1-dx) * get_pixel_extend(im, ix, iy, c) +
        dy     * (1-dx) * get_pixel_extend(im, ix, iy+1, c) +
        (1-dy) *   dx   * get_pixel_extend(im, ix+1, iy, c) +
        dy     *   dx   * get_pixel_extend(im, ix+1, iy+1, c);
    return val;
}
</code></pre>
<ul>
<li>&#xC30D;&#xC120;&#xD615; &#xBCF4;&#xAC04;&#xBC95; &#xC785;&#xB2C8;&#xB2E4;.</li>
</ul>
<p>&#xBAA8;&#xB974;&#xB294; &#xAC12; val&#xC744; 4&#xAC1C;&#xC758; &#xC778;&#xC811;&#xD55C; &#xC810;&#xB4E4;&#xC758; &#xAC12;&#xACFC; &#xBA74;&#xC801;&#xC744; &#xAC00;&#xC911;&#xCE58;&#xB85C; &#xD574;&#xC11C; &#xC720;&#xCD94;&#xD569;&#xB2C8;&#xB2E4;.</p>
<p><img src="../figure/bilinear.PNG" alt="bilinear"></p>
<h2 id="compositeimage">composite_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">composite_image</span><span class="hljs-params">(image source, image dest, <span class="hljs-keyword">int</span> dx, <span class="hljs-keyword">int</span> dy)</span>
</span>{
    <span class="hljs-keyword">int</span> x,y,k;
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; source.c; ++k){
        <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; source.h; ++y){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; source.w; ++x){
                <span class="hljs-keyword">float</span> val = get_pixel(source, x, y, k);
                <span class="hljs-keyword">float</span> val2 = get_pixel_extend(dest, dx+x, dy+y, k);
                set_pixel(dest, dx+x, dy+y, k, val * val2);
            }
        }
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xD569;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="borderimage">border_image</h2>
<pre><code class="lang-c">
<span class="hljs-function">image <span class="hljs-title">border_image</span><span class="hljs-params">(image a, <span class="hljs-keyword">int</span> border)</span>
</span>{
    image b = make_image(a.w + <span class="hljs-number">2</span>*border, a.h + <span class="hljs-number">2</span>*border, a.c);
    <span class="hljs-keyword">int</span> x,y,k;
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; b.c; ++k){
        <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; b.h; ++y){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; b.w; ++x){
                <span class="hljs-keyword">float</span> val = get_pixel_extend(a, x - border, y - border, k);
                <span class="hljs-keyword">if</span>(x - border &lt; <span class="hljs-number">0</span> || x - border &gt;= a.w || y - border &lt; <span class="hljs-number">0</span> || y - border &gt;= a.h) val = <span class="hljs-number">1</span>;
                set_pixel(b, x, y, k, val);
            }
        }
    }
    <span class="hljs-keyword">return</span> b;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC758; &#xD14C;&#xB450;&#xB9AC;&#xB97C; border&#xB9CC;&#xD07C; 1&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="tileimages">tile_images</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">tile_images</span><span class="hljs-params">(image a, image b, <span class="hljs-keyword">int</span> dx)</span>
</span>{
    <span class="hljs-keyword">if</span>(a.w == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> copy_image(b);
    image c = make_image(a.w + b.w + dx, (a.h &gt; b.h) ? a.h : b.h, (a.c &gt; b.c) ? a.c : b.c);
    fill_cpu(c.w*c.h*c.c, <span class="hljs-number">1</span>, c.data, <span class="hljs-number">1</span>);
    embed_image(a, c, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    composite_image(b, c, a.w + dx, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> c;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xAC00; &#xD0C0;&#xC77C;&#xAC19;&#xC774; &#xD45C;&#xD604; &#xB429;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="getlabel">get_label</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">get_label</span><span class="hljs-params">(image **characters, <span class="hljs-keyword">char</span> *<span class="hljs-built_in">string</span>, <span class="hljs-keyword">int</span> size)</span>
</span>{
    size = size/<span class="hljs-number">10</span>;
    <span class="hljs-keyword">if</span>(size &gt; <span class="hljs-number">7</span>) size = <span class="hljs-number">7</span>;
    image label = make_empty_image(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">while</span>(*<span class="hljs-built_in">string</span>){
        image l = characters[size][(<span class="hljs-keyword">int</span>)*<span class="hljs-built_in">string</span>];
        image n = tile_images(label, l, -size - <span class="hljs-number">1</span> + (size+<span class="hljs-number">1</span>)/<span class="hljs-number">2</span>);
        free_image(label);
        label = n;
        ++<span class="hljs-built_in">string</span>;
    }
    image b = border_image(label, label.h*<span class="hljs-number">.25</span>);
    free_image(label);
    <span class="hljs-keyword">return</span> b;
}
</code></pre>
<ul>
<li>label&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="drawlabel">draw_label</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw_label</span><span class="hljs-params">(image a, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> c, image label, <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> *rgb)</span>
</span>{
    <span class="hljs-keyword">int</span> w = label.w;
    <span class="hljs-keyword">int</span> h = label.h;
    <span class="hljs-keyword">if</span> (r - h &gt;= <span class="hljs-number">0</span>) r = r - h;

    <span class="hljs-keyword">int</span> i, j, k;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; h &amp;&amp; j + r &lt; a.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; w &amp;&amp; i + c &lt; a.w; ++i){
            <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; label.c; ++k){
                <span class="hljs-keyword">float</span> val = get_pixel(label, i, j, k);
                set_pixel(a, i+c, j+r, k, rgb[k] * val);
            }
        }
    }
}
</code></pre>
<ul>
<li>label&#xC744; &#xADF8;&#xB9BD;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="drawbox">draw_box</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw_box</span><span class="hljs-params">(image a, <span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> y1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> y2, <span class="hljs-keyword">float</span> r, <span class="hljs-keyword">float</span> g, <span class="hljs-keyword">float</span> b)</span>
</span>{
    <span class="hljs-comment">//normalize_image(a);</span>
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">if</span>(x1 &lt; <span class="hljs-number">0</span>) x1 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(x1 &gt;= a.w) x1 = a.w<span class="hljs-number">-1</span>;
    <span class="hljs-keyword">if</span>(x2 &lt; <span class="hljs-number">0</span>) x2 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(x2 &gt;= a.w) x2 = a.w<span class="hljs-number">-1</span>;

    <span class="hljs-keyword">if</span>(y1 &lt; <span class="hljs-number">0</span>) y1 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(y1 &gt;= a.h) y1 = a.h<span class="hljs-number">-1</span>;
    <span class="hljs-keyword">if</span>(y2 &lt; <span class="hljs-number">0</span>) y2 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(y2 &gt;= a.h) y2 = a.h<span class="hljs-number">-1</span>;

    <span class="hljs-keyword">for</span>(i = x1; i &lt;= x2; ++i){
        a.data[i + y1*a.w + <span class="hljs-number">0</span>*a.w*a.h] = r;
        a.data[i + y2*a.w + <span class="hljs-number">0</span>*a.w*a.h] = r;

        a.data[i + y1*a.w + <span class="hljs-number">1</span>*a.w*a.h] = g;
        a.data[i + y2*a.w + <span class="hljs-number">1</span>*a.w*a.h] = g;

        a.data[i + y1*a.w + <span class="hljs-number">2</span>*a.w*a.h] = b;
        a.data[i + y2*a.w + <span class="hljs-number">2</span>*a.w*a.h] = b;
    }
    <span class="hljs-keyword">for</span>(i = y1; i &lt;= y2; ++i){
        a.data[x1 + i*a.w + <span class="hljs-number">0</span>*a.w*a.h] = r;
        a.data[x2 + i*a.w + <span class="hljs-number">0</span>*a.w*a.h] = r;

        a.data[x1 + i*a.w + <span class="hljs-number">1</span>*a.w*a.h] = g;
        a.data[x2 + i*a.w + <span class="hljs-number">1</span>*a.w*a.h] = g;

        a.data[x1 + i*a.w + <span class="hljs-number">2</span>*a.w*a.h] = b;
        a.data[x2 + i*a.w + <span class="hljs-number">2</span>*a.w*a.h] = b;
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC5D0; box&#xB97C; &#xADF8;&#xB9BD;&#xB2C8;&#xB2E4;.</li>
<li>&#xC88C;&#xC0C1;&#xB2E8;(x1, y1)</li>
<li>&#xC6B0;&#xD558;&#xB2E8;(x2, y2)</li>
</ul>
<h2 id="drawboxwidth">draw_box_width</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw_box_width</span><span class="hljs-params">(image a, <span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> y1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> y2, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">float</span> r, <span class="hljs-keyword">float</span> g, <span class="hljs-keyword">float</span> b)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; w; ++i){
        draw_box(a, x1+i, y1+i, x2-i, y2-i, r, g, b);
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC5D0; &#xC724;&#xACFD;&#xC120; &#xB450;&#xAED8;&#xAC00; w&#xC778; box&#xB97C; &#xADF8;&#xB9BD;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="drawbbox">draw_bbox</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw_bbox</span><span class="hljs-params">(image a, box bbox, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">float</span> r, <span class="hljs-keyword">float</span> g, <span class="hljs-keyword">float</span> b)</span>
</span>{
    <span class="hljs-keyword">int</span> left  = (bbox.x-bbox.w/<span class="hljs-number">2</span>)*a.w;
    <span class="hljs-keyword">int</span> right = (bbox.x+bbox.w/<span class="hljs-number">2</span>)*a.w;
    <span class="hljs-keyword">int</span> top   = (bbox.y-bbox.h/<span class="hljs-number">2</span>)*a.h;
    <span class="hljs-keyword">int</span> bot   = (bbox.y+bbox.h/<span class="hljs-number">2</span>)*a.h;

    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; w; ++i){
        draw_box(a, left+i, top+i, right-i, bot-i, r, g, b);
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC5D0; box&#xB97C; &#xADF8;&#xB9BD;&#xB2C8;&#xB2E4;. &#xC778;&#xC790;&#xAC12;&#xC73C;&#xB85C; box &#xD0C0;&#xC785;&#xC744; &#xBC1B;&#xC2B5;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="loadalphabet">load_alphabet</h2>
<pre><code class="lang-c"><span class="hljs-function">image **<span class="hljs-title">load_alphabet</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> nsize = <span class="hljs-number">8</span>;
    image **alphabets = <span class="hljs-built_in">calloc</span>(nsize, <span class="hljs-keyword">sizeof</span>(image));
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; nsize; ++j){
        alphabets[j] = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">128</span>, <span class="hljs-keyword">sizeof</span>(image));
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">32</span>; i &lt; <span class="hljs-number">127</span>; ++i){
            <span class="hljs-keyword">char</span> buff[<span class="hljs-number">256</span>];
            <span class="hljs-built_in">sprintf</span>(buff, <span class="hljs-string">&quot;data/labels/%d_%d.png&quot;</span>, i, j);
            alphabets[j][i] = load_image_color(buff, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        }
    }
    <span class="hljs-keyword">return</span> alphabets;
}
</code></pre>
<ul>
<li><code>data/labels/</code>&#xD3F4;&#xB354;&#xC5D0; &#xC788;&#xB294; &#xBAA8;&#xB4E0; alphabet &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC77D;&#xC5B4;&#xB4E4;&#xC785;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="drawdetections">draw_detections</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw_detections</span><span class="hljs-params">(image im, detection *dets, <span class="hljs-keyword">int</span> num, <span class="hljs-keyword">float</span> thresh, <span class="hljs-keyword">char</span> **names, image **alphabet, <span class="hljs-keyword">int</span> classes)</span>
</span>{
    <span class="hljs-keyword">int</span> i,j;

    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; num; ++i){
        <span class="hljs-keyword">char</span> labelstr[<span class="hljs-number">4096</span>] = {<span class="hljs-number">0</span>};
        <span class="hljs-keyword">int</span> <span class="hljs-keyword">class</span> = <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; classes; ++j){                                       
            <span class="hljs-keyword">if</span> (dets[i].prob[j] &gt; thresh){                                      <span class="hljs-comment">// probability&#xAC00; thresh&#xBCF4;&#xB2E4; &#xD070; &#xACBD;&#xC6B0;&#xC758; &#xD074;&#xB798;&#xC2A4;&#xB97C; &#xCD9C;&#xB825;&#xD569;&#xB2C8;&#xB2E4;.</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">class</span> &lt; <span class="hljs-number">0</span>) {
                    <span class="hljs-built_in">strcat</span>(labelstr, names[j]);
                    <span class="hljs-keyword">class</span> = j;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-built_in">strcat</span>(labelstr, <span class="hljs-string">&quot;, &quot;</span>);
                    <span class="hljs-built_in">strcat</span>(labelstr, names[j]);
                }
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s: %.0f%%\n&quot;</span>, names[j], dets[i].prob[j]*<span class="hljs-number">100</span>);
            }
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">class</span> &gt;= <span class="hljs-number">0</span>){
            <span class="hljs-keyword">int</span> width = im.h * <span class="hljs-number">.006</span>;

            <span class="hljs-comment">/*
               if(0){
               width = pow(prob, 1./2.)*10+1;
               alphabet = 0;
               }
             */</span>

            <span class="hljs-comment">//printf(&quot;%d %s: %.0f%%\n&quot;, i, names[class], prob*100);</span>
            <span class="hljs-keyword">int</span> offset = <span class="hljs-keyword">class</span>*<span class="hljs-number">123457</span> % classes;
            <span class="hljs-keyword">float</span> red = get_color(<span class="hljs-number">2</span>,offset,classes);
            <span class="hljs-keyword">float</span> green = get_color(<span class="hljs-number">1</span>,offset,classes);
            <span class="hljs-keyword">float</span> blue = get_color(<span class="hljs-number">0</span>,offset,classes);
            <span class="hljs-keyword">float</span> rgb[<span class="hljs-number">3</span>];

            <span class="hljs-comment">//width = prob*20+2;</span>

            rgb[<span class="hljs-number">0</span>] = red;
            rgb[<span class="hljs-number">1</span>] = green;
            rgb[<span class="hljs-number">2</span>] = blue;
            box b = dets[i].bbox;
            <span class="hljs-comment">//printf(&quot;%f %f %f %f\n&quot;, b.x, b.y, b.w, b.h);</span>

            <span class="hljs-keyword">int</span> left  = (b.x-b.w/<span class="hljs-number">2.</span>)*im.w;
            <span class="hljs-keyword">int</span> right = (b.x+b.w/<span class="hljs-number">2.</span>)*im.w;
            <span class="hljs-keyword">int</span> top   = (b.y-b.h/<span class="hljs-number">2.</span>)*im.h;
            <span class="hljs-keyword">int</span> bot   = (b.y+b.h/<span class="hljs-number">2.</span>)*im.h;

            <span class="hljs-keyword">if</span>(left &lt; <span class="hljs-number">0</span>) left = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span>(right &gt; im.w<span class="hljs-number">-1</span>) right = im.w<span class="hljs-number">-1</span>;
            <span class="hljs-keyword">if</span>(top &lt; <span class="hljs-number">0</span>) top = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span>(bot &gt; im.h<span class="hljs-number">-1</span>) bot = im.h<span class="hljs-number">-1</span>;

            draw_box_width(im, left, top, right, bot, width, red, green, blue); <span class="hljs-comment">// box&#xB97C; &#xADF8;&#xB9BD;&#xB2C8;&#xB2E4;.</span>
            <span class="hljs-keyword">if</span> (alphabet) {                                                     <span class="hljs-comment">// label&#xC744; &#xD45C;&#xC2DC;&#xD569;&#xB2C8;&#xB2E4;.</span>
                image label = get_label(alphabet, labelstr, (im.h*<span class="hljs-number">.03</span>));
                draw_label(im, top + width, left, label, rgb);
                free_image(label);
            }
            <span class="hljs-keyword">if</span> (dets[i].mask){                                                  <span class="hljs-comment">//</span>
                image mask = float_to_image(<span class="hljs-number">14</span>, <span class="hljs-number">14</span>, <span class="hljs-number">1</span>, dets[i].mask);
                image resized_mask = resize_image(mask, b.w*im.w, b.h*im.h);
                image tmask = threshold_image(resized_mask, <span class="hljs-number">.5</span>);
                embed_image(tmask, im, left, top);
                free_image(mask);
                free_image(resized_mask);
                free_image(tmask);
            }
        }
    }
}
</code></pre>
<h2 id="transposeimage">transpose_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">transpose_image</span><span class="hljs-params">(image im)</span>
</span>{
    assert(im.w == im.h);
    <span class="hljs-keyword">int</span> n, m;
    <span class="hljs-keyword">int</span> c;
    <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; im.c; ++c){
        <span class="hljs-keyword">for</span>(n = <span class="hljs-number">0</span>; n &lt; im.w<span class="hljs-number">-1</span>; ++n){
            <span class="hljs-keyword">for</span>(m = n + <span class="hljs-number">1</span>; m &lt; im.w; ++m){
                <span class="hljs-keyword">float</span> swap = im.data[m + im.w*(n + im.h*c)];
                im.data[m + im.w*(n + im.h*c)] = im.data[n + im.w*(m + im.h*c)];
                im.data[n + im.w*(m + im.h*c)] = swap;
            }
        }
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC804;&#xCE58; &#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li>
</ul>
<pre><code>-------------                   -------------
| 1 | 2 | 3 |                   | 1 | 4 | 7 |
-------------                   -------------
| 4 | 5 | 6 |        -&gt;         | 2 | 5 | 8 |
-------------                   -------------
| 7 | 8 | 9 |                   | 3 | 6 | 9 |
-------------                   -------------
</code></pre><h2 id="flipimages">flip_images</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flip_image</span><span class="hljs-params">(image a)</span>
</span>{
    <span class="hljs-keyword">int</span> i,j,k;
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; a.c; ++k){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; a.h; ++i){
            <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; a.w/<span class="hljs-number">2</span>; ++j){
                <span class="hljs-keyword">int</span> index = j + a.w*(i + a.h*(k));
                <span class="hljs-keyword">int</span> flip = (a.w - j - <span class="hljs-number">1</span>) + a.w*(i + a.h*(k));
                <span class="hljs-keyword">float</span> swap = a.data[flip];
                a.data[flip] = a.data[index];
                a.data[index] = swap;
            }
        }
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC218;&#xC9C1;&#xC744; &#xAE30;&#xC900;&#xC73C;&#xB85C; &#xB4A4;&#xC9D1;&#xC2B5;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="rotateimagecw">rotate_image_cw</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rotate_image_cw</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> times)</span>
</span>{
    assert(im.w == im.h);
    times = (times + <span class="hljs-number">400</span>) % <span class="hljs-number">4</span>;
    <span class="hljs-keyword">int</span> i, x, y, c;
    <span class="hljs-keyword">int</span> n = im.w;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; times; ++i){
        <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; im.c; ++c){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; n/<span class="hljs-number">2</span>; ++x){
                <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; (n<span class="hljs-number">-1</span>)/<span class="hljs-number">2</span> + <span class="hljs-number">1</span>; ++y){
                    <span class="hljs-keyword">float</span> temp = im.data[y + im.w*(x + im.h*c)];
                    im.data[y + im.w*(x + im.h*c)] = im.data[n<span class="hljs-number">-1</span>-x + im.w*(y + im.h*c)];
                    im.data[n<span class="hljs-number">-1</span>-x + im.w*(y + im.h*c)] = im.data[n<span class="hljs-number">-1</span>-y + im.w*(n<span class="hljs-number">-1</span>-x + im.h*c)];
                    im.data[n<span class="hljs-number">-1</span>-y + im.w*(n<span class="hljs-number">-1</span>-x + im.h*c)] = im.data[x + im.w*(n<span class="hljs-number">-1</span>-y + im.h*c)];
                    im.data[x + im.w*(n<span class="hljs-number">-1</span>-y + im.h*c)] = temp;
                }
            }
        }
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xAC00; times &#xB9CC;&#xD07C; &#xD68C;&#xC804; &#xB429;&#xB2C8;&#xB2E4;.</li>
<li>times&#xB294; &#xC2DC;&#xACC4;&#xBC29;&#xD5A5;&#xC73C;&#xB85C;<ul>
<li>0 : 360&#xB3C4;</li>
<li>1 : 270&#xB3C4;</li>
<li>2 : 180&#xB3C4;</li>
<li>3 : 90&#xB3C4;</li>
</ul>
</li>
</ul>
<h2 id="imagedistance">image_distance</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">image_distance</span><span class="hljs-params">(image a, image b)</span>
</span>{
    <span class="hljs-keyword">int</span> i,j;
    image dist = make_image(a.w, a.h, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; a.c; ++i){
        <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; a.h*a.w; ++j){
            dist.data[j] += <span class="hljs-built_in">pow</span>(a.data[i*a.h*a.w+j]-b.data[i*a.h*a.w+j],<span class="hljs-number">2</span>);
        }
    }
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; a.h*a.w; ++j){
        dist.data[j] = <span class="hljs-built_in">sqrt</span>(dist.data[j]);
    }
    <span class="hljs-keyword">return</span> dist;
}
</code></pre>
<ul>
<li><p>&#xC774;&#xBBF8;&#xC9C0; &#xD53D;&#xC140;&#xAC04;&#xC758; &#xAC70;&#xB9AC;&#xB97C; &#xAD6C;&#xD569;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p><script type="math/tex; ">\sqrt{(a - b)^2}</script></p>
</li>
</ul>
<h2 id="ghostimage">ghost_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ghost_image</span><span class="hljs-params">(image source, image dest, <span class="hljs-keyword">int</span> dx, <span class="hljs-keyword">int</span> dy)</span>
</span>{
    <span class="hljs-keyword">int</span> x,y,k;
    <span class="hljs-keyword">float</span> max_dist = <span class="hljs-built_in">sqrt</span>((-source.w/<span class="hljs-number">2.</span> + <span class="hljs-number">.5</span>)*(-source.w/<span class="hljs-number">2.</span> + <span class="hljs-number">.5</span>));
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; source.c; ++k){
        <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; source.h; ++y){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; source.w; ++x){
                <span class="hljs-keyword">float</span> dist = <span class="hljs-built_in">sqrt</span>((x - source.w/<span class="hljs-number">2.</span> + <span class="hljs-number">.5</span>)*(x - source.w/<span class="hljs-number">2.</span> + <span class="hljs-number">.5</span>) + (y - source.h/<span class="hljs-number">2.</span> + <span class="hljs-number">.5</span>)*(y - source.h/<span class="hljs-number">2.</span> + <span class="hljs-number">.5</span>));
                <span class="hljs-keyword">float</span> alpha = (<span class="hljs-number">1</span> - dist/max_dist);
                <span class="hljs-keyword">if</span>(alpha &lt; <span class="hljs-number">0</span>) alpha = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">float</span> v1 = get_pixel(source, x,y,k);
                <span class="hljs-keyword">float</span> v2 = get_pixel(dest, dx+x,dy+y,k);
                <span class="hljs-keyword">float</span> val = alpha*v1 + (<span class="hljs-number">1</span>-alpha)*v2;
                set_pixel(dest, dx+x, dy+y, k, val);
            }
        }
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xB450;&#xAC1C; &#xACB0;&#xD569;&#xD569;&#xB2C8;&#xB2E4;. source image&#xC5D0;&#xB294; &#xB9C8;&#xCE58; &#xC720;&#xB839;&#xCC98;&#xB7FC; &#xD76C;&#xBBF8;&#xD55C; &#xD615;&#xD0DC;&#xC758; dest &#xC774;&#xBBF8;&#xC9C0;&#xAC00; &#xBCF4;&#xC774;&#xAC8C; &#xB429;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="blockyimage">blocky_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">blocky_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> s)</span>
</span>{
    <span class="hljs-keyword">int</span> i,j,k;
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; im.c; ++k){
        <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
                im.data[i + im.w*(j + im.h*k)] = im.data[i/s*s + im.w*(j/s*s + im.h*k)];
            }
        }
    }
}
</code></pre>
<ul>
<li><p>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xBE14;&#xB85D; &#xD615;&#xD0DC;&#xB85C; &#xD45C;&#xD604;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xD568;&#xC218; &#xC785;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p>s&#xC758; &#xAC12;&#xC774; &#xD074;&#xC218;&#xB85D; &#xD53D;&#xC140;&#xC774; &#xB208;&#xC5D0; &#xBCF4;&#xC774;&#xB3C4;&#xB85D; &#xD654;&#xC9C8;&#xC774; &#xB098;&#xBE60;&#xC9D1;&#xB2C8;&#xB2E4;.</p>
</li>
</ul>
<p><img src="../figure/blocky.PNG" alt="im2col"></p>
<h2 id="censorimage">censor_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">censor_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> dx, <span class="hljs-keyword">int</span> dy, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    <span class="hljs-keyword">int</span> i,j,k;
    <span class="hljs-keyword">int</span> s = <span class="hljs-number">32</span>;
    <span class="hljs-keyword">if</span>(dx &lt; <span class="hljs-number">0</span>) dx = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(dy &lt; <span class="hljs-number">0</span>) dy = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; im.c; ++k){
        <span class="hljs-keyword">for</span>(j = dy; j &lt; dy + h &amp;&amp; j &lt; im.h; ++j){
            <span class="hljs-keyword">for</span>(i = dx; i &lt; dx + w &amp;&amp; i &lt; im.w; ++i){
                im.data[i + im.w*(j + im.h*k)] = im.data[i/s*s + im.w*(j/s*s + im.h*k)];
                <span class="hljs-comment">//im.data[i + j*im.w + k*im.w*im.h] = 0;</span>
            }
        }
    }
}
</code></pre>
<ul>
<li><p>blocky&#xC5D0; crop&#xC774; &#xC788;&#xB294; &#xD568;&#xC218; &#xC785;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p>&#xC2E4;&#xC81C; &#xC0AC;&#xC6A9;&#xC740; &#xB418;&#xC9C0; &#xC54A;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
</li>
</ul>
<h2 id="embedimage">embed_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">embed_image</span><span class="hljs-params">(image source, image dest, <span class="hljs-keyword">int</span> dx, <span class="hljs-keyword">int</span> dy)</span>
</span>{
    <span class="hljs-keyword">int</span> x,y,k;
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; source.c; ++k){
        <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; source.h; ++y){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; source.w; ++x){
                <span class="hljs-keyword">float</span> val = get_pixel(source, x,y,k);
                set_pixel(dest, dx+x, dy+y, k, val);
            }
        }
    }
}
</code></pre>
<ul>
<li><p>dest&#xC5D0; source image&#xB97C; &#xB123;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p>dx, dy&#xAC00; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xB123;&#xC744; &#xC704;&#xCE58;&#xB97C; &#xC870;&#xC808;&#xD574; &#xC90D;&#xB2C8;&#xB2E4;.</p>
</li>
</ul>
<h2 id="collapseimagelayers">collapse_image_layers</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">collapse_image_layers</span><span class="hljs-params">(image source, <span class="hljs-keyword">int</span> border)</span>
</span>{
    <span class="hljs-keyword">int</span> h = source.h;
    h = (h+border)*source.c - border;
    image dest = make_image(source.w, h, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; source.c; ++i){
        image layer = get_image_layer(source, i);
        <span class="hljs-keyword">int</span> h_offset = i*(source.h+border);
        embed_image(layer, dest, <span class="hljs-number">0</span>, h_offset);
        free_image(layer);
    }
    <span class="hljs-keyword">return</span> dest;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC758; &#xAC01; &#xCC44;&#xB110;&#xC744; &#xACB0;&#xD569;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="constrainimage">constrain_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">constrain_image</span><span class="hljs-params">(image im)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w*im.h*im.c; ++i){
        <span class="hljs-keyword">if</span>(im.data[i] &lt; <span class="hljs-number">0</span>) im.data[i] = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span>(im.data[i] &gt; <span class="hljs-number">1</span>) im.data[i] = <span class="hljs-number">1</span>;
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC774;&#xC9C4;&#xD654; &#xD569;&#xB2C8;&#xB2E4;.<ul>
<li>0&#xBCF4;&#xB2E4; &#xC791;&#xC740; &#xAC12;&#xC740; 0</li>
<li>1&#xBCF4;&#xB2E4; &#xD070; &#xAC12;&#xC740; 1</li>
</ul>
</li>
</ul>
<h2 id="normalizeimage">normalize_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">normalize_image</span><span class="hljs-params">(image p)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">float</span> min = <span class="hljs-number">9999999</span>;
    <span class="hljs-keyword">float</span> max = <span class="hljs-number">-999999</span>;

    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; p.h*p.w*p.c; ++i){
        <span class="hljs-keyword">float</span> v = p.data[i];
        <span class="hljs-keyword">if</span>(v &lt; min) min = v;
        <span class="hljs-keyword">if</span>(v &gt; max) max = v;
    }
    <span class="hljs-keyword">if</span>(max - min &lt; <span class="hljs-number">.000000001</span>){
        min = <span class="hljs-number">0</span>;
        max = <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; p.c*p.w*p.h; ++i){
        p.data[i] = (p.data[i] - min)/(max-min);
    }
}
</code></pre>
<ul>
<li><p>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; min max scaling &#xD569;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p><script type="math/tex; ">\frac{x_i - min(x)}{max(x) - min(x)}</script></p>
</li>
</ul>
<h2 id="normalizeimage2">normalize_image2</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">normalize_image2</span><span class="hljs-params">(image p)</span>
</span>{
    <span class="hljs-keyword">float</span> *min = <span class="hljs-built_in">calloc</span>(p.c, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));
    <span class="hljs-keyword">float</span> *max = <span class="hljs-built_in">calloc</span>(p.c, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));
    <span class="hljs-keyword">int</span> i,j;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; p.c; ++i) min[i] = max[i] = p.data[i*p.h*p.w];

    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; p.c; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; p.h*p.w; ++i){
            <span class="hljs-keyword">float</span> v = p.data[i+j*p.h*p.w];
            <span class="hljs-keyword">if</span>(v &lt; min[j]) min[j] = v;
            <span class="hljs-keyword">if</span>(v &gt; max[j]) max[j] = v;
        }
    }
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; p.c; ++i){
        <span class="hljs-keyword">if</span>(max[i] - min[i] &lt; <span class="hljs-number">.000000001</span>){
            min[i] = <span class="hljs-number">0</span>;
            max[i] = <span class="hljs-number">1</span>;
        }
    }
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; p.c; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; p.w*p.h; ++i){
            p.data[i+j*p.h*p.w] = (p.data[i+j*p.h*p.w] - min[j])/(max[j]-min[j]);
        }
    }
    <span class="hljs-built_in">free</span>(min);
    <span class="hljs-built_in">free</span>(max);
}
</code></pre>
<ul>
<li><p>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; min max scaling &#xD569;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p><script type="math/tex; ">\frac{x_i - min(x)}{max(x) - min(x)}</script></p>
</li>
<li><p><code>normalize_image</code> &#xD568;&#xC218;&#xB791; for&#xBB38; &#xB3D9;&#xC791; &#xBC29;&#xC2DD;&#xB9CC; &#xB2E4;&#xB978; &#xAC83; &#xAC19;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
</li>
</ul>
<h2 id="copyimageinto">copy_image_into</h2>
<pre><code class="lang-c">void copy_image_into(image src, image dest)
{
    memcpy(dest.data, src.data, src.h*src.w*src.c*sizeof(float));
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="copyimage">copy_image</h2>
<pre><code class="lang-c">image copy_image(image p)
{
    image copy = p;
    copy.data = calloc(p.h*p.w*p.c, sizeof(float));
    memcpy(copy.data, p.data, p.h*p.w*p.c*sizeof(float));
    return copy;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xBCF5;&#xC0AC;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="rgbgrimage">rgbgr_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rgbgr_image</span><span class="hljs-params">(image im)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w*im.h; ++i){
        <span class="hljs-keyword">float</span> swap = im.data[i];
        im.data[i] = im.data[i+im.w*im.h*<span class="hljs-number">2</span>];
        im.data[i+im.w*im.h*<span class="hljs-number">2</span>] = swap;
    }
}
</code></pre>
<ul>
<li>RGB&#xB97C; BGR&#xB85C; BGR&#xC744; RGB&#xB85C; &#xBC14;&#xAFC9;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="showimage">show_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">show_image</span><span class="hljs-params">(image p, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name, <span class="hljs-keyword">int</span> ms)</span>
</span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> OPENCV</span>
    <span class="hljs-keyword">int</span> c = show_image_cv(p, name, ms);
    <span class="hljs-keyword">return</span> c;
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Not compiled with OpenCV, saving to %s.png instead\n&quot;</span>, name);
    save_image(p, name);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="saveimageoptions">save_image_options</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save_image_options</span><span class="hljs-params">(image im, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name, IMTYPE f, <span class="hljs-keyword">int</span> quality)</span>
</span>{
    <span class="hljs-keyword">char</span> buff[<span class="hljs-number">256</span>];
    <span class="hljs-comment">//sprintf(buff, &quot;%s (%d)&quot;, name, windows);</span>
    <span class="hljs-keyword">if</span>(f == PNG)       <span class="hljs-built_in">sprintf</span>(buff, <span class="hljs-string">&quot;%s.png&quot;</span>, name);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f == BMP) <span class="hljs-built_in">sprintf</span>(buff, <span class="hljs-string">&quot;%s.bmp&quot;</span>, name);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f == TGA) <span class="hljs-built_in">sprintf</span>(buff, <span class="hljs-string">&quot;%s.tga&quot;</span>, name);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f == JPG) <span class="hljs-built_in">sprintf</span>(buff, <span class="hljs-string">&quot;%s.jpg&quot;</span>, name);
    <span class="hljs-keyword">else</span>               <span class="hljs-built_in">sprintf</span>(buff, <span class="hljs-string">&quot;%s.png&quot;</span>, name);
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *data = <span class="hljs-built_in">calloc</span>(im.w*im.h*im.c, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>));
    <span class="hljs-keyword">int</span> i,k;
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; im.c; ++k){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w*im.h; ++i){
            data[i*im.c+k] = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>) (<span class="hljs-number">255</span>*im.data[i + k*im.w*im.h]);
        }
    }
    <span class="hljs-keyword">int</span> success = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span>(f == PNG)       success = stbi_write_png(buff, im.w, im.h, im.c, data, im.w*im.c);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f == BMP) success = stbi_write_bmp(buff, im.w, im.h, im.c, data);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f == TGA) success = stbi_write_tga(buff, im.w, im.h, im.c, data);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f == JPG) success = stbi_write_jpg(buff, im.w, im.h, im.c, data, quality);
    <span class="hljs-built_in">free</span>(data);
    <span class="hljs-keyword">if</span>(!success) <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Failed to write image %s\n&quot;</span>, buff);
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xB2E4;&#xC591;&#xD55C; &#xD655;&#xC7A5;&#xC790;(PNG, BMP, TGA, JPG)&#xB85C; &#xC800;&#xC7A5;&#xD558;&#xAE30; &#xC704;&#xD55C; &#xD568;&#xC218; &#xC785;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="saveimage">save_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span>
</span>{
    save_image_options(im, name, JPG, <span class="hljs-number">80</span>);
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC800;&#xC7A5;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="showimagelayers">show_image_layers</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show_image_layers</span><span class="hljs-params">(image p, <span class="hljs-keyword">char</span> *name)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">char</span> buff[<span class="hljs-number">256</span>];
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; p.c; ++i){
        <span class="hljs-built_in">sprintf</span>(buff, <span class="hljs-string">&quot;%s - Layer %d&quot;</span>, name, i);
        image layer = get_image_layer(p, i);
        show_image(layer, buff, <span class="hljs-number">1</span>);
        free_image(layer);
    }
}
</code></pre>
<ul>
<li>&#xD2B9;&#xC815; layer&#xC758; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="showimagecollapsed">show_image_collapsed</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show_image_collapsed</span><span class="hljs-params">(image p, <span class="hljs-keyword">char</span> *name)</span>
</span>{
    image c = collapse_image_layers(p, <span class="hljs-number">1</span>);
    show_image(c, name, <span class="hljs-number">1</span>);
    free_image(c);
}
</code></pre>
<ul>
<li>&#xAC01; &#xCC44;&#xB110;&#xC744; &#xACB0;&#xD569;&#xD55C; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC2DC;&#xAC01;&#xD654; &#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="makeemptyimage">make_empty_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">make_empty_image</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> c)</span>
</span>{
    image out;
    out.data = <span class="hljs-number">0</span>;
    out.h = h;
    out.w = w;
    out.c = c;
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<ul>
<li>&#xBE44;&#xC5B4;&#xC788;&#xB294; image&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="makeimage">make_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">make_image</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> c)</span>
</span>{
    image out = make_empty_image(w,h,c);
    out.data = <span class="hljs-built_in">calloc</span>(h*w*c, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<ul>
<li>&#xBE44;&#xC5B4;&#xC788;&#xB294; image&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.(&#xBA54;&#xBAA8;&#xB9AC; &#xD560;&#xB2F9;, &#xBAA8;&#xB4E0; &#xAC12; 0)</li>
</ul>
<h2 id="makerandomimage">make_random_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">make_random_image</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> c)</span>
</span>{
    image out = make_empty_image(w,h,c);
    out.data = <span class="hljs-built_in">calloc</span>(h*w*c, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; w*h*c; ++i){
        out.data[i] = (rand_normal() * <span class="hljs-number">.25</span>) + <span class="hljs-number">.5</span>;
    }
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<ul>
<li>&#xB79C;&#xB364;&#xD55C; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC0DD;&#xC131;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="floattoimage">float_to_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">float_to_image</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">float</span> *data)</span>
</span>{
    image out = make_empty_image(w,h,c);
    out.data = data;
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<ul>
<li>float &#xB370;&#xC774;&#xD130;&#xB97C; &#xC774;&#xBBF8;&#xC9C0;&#xB85C; &#xB9CC;&#xB4ED;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="placeimage">place_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">place_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> dx, <span class="hljs-keyword">int</span> dy, image canvas)</span>
</span>{
    <span class="hljs-keyword">int</span> x, y, c;
    <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; im.c; ++c){
        <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; h; ++y){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; w; ++x){
                <span class="hljs-keyword">float</span> rx = ((<span class="hljs-keyword">float</span>)x / w) * im.w;
                <span class="hljs-keyword">float</span> ry = ((<span class="hljs-keyword">float</span>)y / h) * im.h;
                <span class="hljs-keyword">float</span> val = bilinear_interpolate(im, rx, ry, c);
                set_pixel(canvas, x + dx, y + dy, c, val);
            }
        }
    }
}
</code></pre>
<h2 id="centercropimage">center_crop_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">center_crop_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    <span class="hljs-keyword">int</span> m = (im.w &lt; im.h) ? im.w : im.h;   
    image c = crop_image(im, (im.w - m) / <span class="hljs-number">2</span>, (im.h - m)/<span class="hljs-number">2</span>, m, m);
    image r = resize_image(c, w, h);
    free_image(c);
    <span class="hljs-keyword">return</span> r;
}
</code></pre>
<ul>
<li>&#xC911;&#xC2EC; &#xC601;&#xC5ED;&#xC744; crop&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="rotatecropimage">rotate_crop_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">rotate_crop_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> rad, <span class="hljs-keyword">float</span> s, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">float</span> dx, <span class="hljs-keyword">float</span> dy, <span class="hljs-keyword">float</span> aspect)</span>
</span>{
    <span class="hljs-keyword">int</span> x, y, c;
    <span class="hljs-keyword">float</span> cx = im.w/<span class="hljs-number">2.</span>;
    <span class="hljs-keyword">float</span> cy = im.h/<span class="hljs-number">2.</span>;
    image rot = make_image(w, h, im.c);
    <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; im.c; ++c){
        <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; h; ++y){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; w; ++x){
                <span class="hljs-keyword">float</span> rx = <span class="hljs-built_in">cos</span>(rad)*((x - w/<span class="hljs-number">2.</span>)/s*aspect + dx/s*aspect) - <span class="hljs-built_in">sin</span>(rad)*((y - h/<span class="hljs-number">2.</span>)/s + dy/s) + cx;
                <span class="hljs-keyword">float</span> ry = <span class="hljs-built_in">sin</span>(rad)*((x - w/<span class="hljs-number">2.</span>)/s*aspect + dx/s*aspect) + <span class="hljs-built_in">cos</span>(rad)*((y - h/<span class="hljs-number">2.</span>)/s + dy/s) + cy;
                <span class="hljs-keyword">float</span> val = bilinear_interpolate(im, rx, ry, c);
                set_pixel(rot, x, y, c, val);
            }
        }
    }
    <span class="hljs-keyword">return</span> rot;
}
</code></pre>
<h2 id="rotateimage">rotate_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">rotate_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> rad)</span>
</span>{
    <span class="hljs-keyword">int</span> x, y, c;
    <span class="hljs-keyword">float</span> cx = im.w/<span class="hljs-number">2.</span>;
    <span class="hljs-keyword">float</span> cy = im.h/<span class="hljs-number">2.</span>;
    image rot = make_image(im.w, im.h, im.c);
    <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; im.c; ++c){
        <span class="hljs-keyword">for</span>(y = <span class="hljs-number">0</span>; y &lt; im.h; ++y){
            <span class="hljs-keyword">for</span>(x = <span class="hljs-number">0</span>; x &lt; im.w; ++x){
                <span class="hljs-keyword">float</span> rx = <span class="hljs-built_in">cos</span>(rad)*(x-cx) - <span class="hljs-built_in">sin</span>(rad)*(y-cy) + cx;
                <span class="hljs-keyword">float</span> ry = <span class="hljs-built_in">sin</span>(rad)*(x-cx) + <span class="hljs-built_in">cos</span>(rad)*(y-cy) + cy;
                <span class="hljs-keyword">float</span> val = bilinear_interpolate(im, rx, ry, c);
                set_pixel(rot, x, y, c, val);
            }
        }
    }
    <span class="hljs-keyword">return</span> rot;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; radius&#xB9CC;&#xD07C; &#xD68C;&#xC804; &#xC2DC;&#xD0B5;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="fillimage">fill_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fill_image</span><span class="hljs-params">(image m, <span class="hljs-keyword">float</span> s)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; m.h*m.w*m.c; ++i) m.data[i] = s;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; s&#xAC12;&#xC73C;&#xB85C; &#xCC44;&#xC6C1;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="translateimage">translate_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">translate_image</span><span class="hljs-params">(image m, <span class="hljs-keyword">float</span> s)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; m.h*m.w*m.c; ++i) m.data[i] += s;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC758; &#xBAA8;&#xB4E0; &#xAC12;&#xC5D0; s&#xB97C; &#xB354;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="scaleimage">scale_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">scale_image</span><span class="hljs-params">(image m, <span class="hljs-keyword">float</span> s)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; m.h*m.w*m.c; ++i) m.data[i] *= s;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC758; scale&#xC744; &#xACF1;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="cropimage">crop_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">crop_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> dx, <span class="hljs-keyword">int</span> dy, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    image cropped = make_image(w, h, im.c);
    <span class="hljs-keyword">int</span> i, j, k;
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; im.c; ++k){
        <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; h; ++j){
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; w; ++i){
                <span class="hljs-keyword">int</span> r = j + dy;
                <span class="hljs-keyword">int</span> c = i + dx;
                <span class="hljs-keyword">float</span> val = <span class="hljs-number">0</span>;
                r = constrain_int(r, <span class="hljs-number">0</span>, im.h<span class="hljs-number">-1</span>);
                c = constrain_int(c, <span class="hljs-number">0</span>, im.w<span class="hljs-number">-1</span>);
                val = get_pixel(im, c, r, k);
                set_pixel(cropped, i, j, k, val);
            }
        }
    }
    <span class="hljs-keyword">return</span> cropped;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; crop &#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="best3dshiftr">best_3d_shift_r</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">best_3d_shift_r</span><span class="hljs-params">(image a, image b, <span class="hljs-keyword">int</span> min, <span class="hljs-keyword">int</span> max)</span>
</span>{
    <span class="hljs-keyword">if</span>(min == max) <span class="hljs-keyword">return</span> min;
    <span class="hljs-keyword">int</span> mid = <span class="hljs-built_in">floor</span>((min + max) / <span class="hljs-number">2.</span>);
    image c1 = crop_image(b, <span class="hljs-number">0</span>, mid, b.w, b.h);
    image c2 = crop_image(b, <span class="hljs-number">0</span>, mid+<span class="hljs-number">1</span>, b.w, b.h);
    <span class="hljs-keyword">float</span> d1 = dist_array(c1.data, a.data, a.w*a.h*a.c, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">float</span> d2 = dist_array(c2.data, a.data, a.w*a.h*a.c, <span class="hljs-number">10</span>);
    free_image(c1);
    free_image(c2);
    <span class="hljs-keyword">if</span>(d1 &lt; d2) <span class="hljs-keyword">return</span> best_3d_shift_r(a, b, min, mid);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> best_3d_shift_r(a, b, mid+<span class="hljs-number">1</span>, max);
}
</code></pre>
<p>-</p>
<h2 id="best3dshift">best_3d_shift</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">best_3d_shift</span><span class="hljs-params">(image a, image b, <span class="hljs-keyword">int</span> min, <span class="hljs-keyword">int</span> max)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">int</span> best = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">float</span> best_distance = FLT_MAX;
    <span class="hljs-keyword">for</span>(i = min; i &lt;= max; i += <span class="hljs-number">2</span>){
        image c = crop_image(b, <span class="hljs-number">0</span>, i, b.w, b.h);
        <span class="hljs-keyword">float</span> d = dist_array(c.data, a.data, a.w*a.h*a.c, <span class="hljs-number">100</span>);
        <span class="hljs-keyword">if</span>(d &lt; best_distance){
            best_distance = d;
            best = i;
        }
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %f\n&quot;</span>, i, d);
        free_image(c);
    }
    <span class="hljs-keyword">return</span> best;
}
</code></pre>
<p>-</p>
<h2 id="composite3d">composite_3d</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">composite_3d</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *f1, <span class="hljs-keyword">char</span> *f2, <span class="hljs-keyword">char</span> *out, <span class="hljs-keyword">int</span> delta)</span>
</span>{
    <span class="hljs-keyword">if</span>(!out) out = <span class="hljs-string">&quot;out&quot;</span>;
    image a = load_image(f1, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    image b = load_image(f2, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">int</span> shift = best_3d_shift_r(a, b, -a.h/<span class="hljs-number">100</span>, a.h/<span class="hljs-number">100</span>);

    image c1 = crop_image(b, <span class="hljs-number">10</span>, shift, b.w, b.h);
    <span class="hljs-keyword">float</span> d1 = dist_array(c1.data, a.data, a.w*a.h*a.c, <span class="hljs-number">100</span>);
    image c2 = crop_image(b, <span class="hljs-number">-10</span>, shift, b.w, b.h);
    <span class="hljs-keyword">float</span> d2 = dist_array(c2.data, a.data, a.w*a.h*a.c, <span class="hljs-number">100</span>);

    <span class="hljs-keyword">if</span>(d2 &lt; d1 &amp;&amp; <span class="hljs-number">0</span>){
        image swap = a;
        a = b;
        b = swap;
        shift = -shift;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;swapped, %d\n&quot;</span>, shift);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, shift);
    }

    image c = crop_image(b, delta, shift, a.w, a.h);
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; c.w*c.h; ++i){
        c.data[i] = a.data[i];
    }
    save_image(c, out);
}
</code></pre>
<h2 id="letterboximageinto">letterbox_image_into</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">letterbox_image_into</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, image boxed)</span>
</span>{
    <span class="hljs-keyword">int</span> new_w = im.w;
    <span class="hljs-keyword">int</span> new_h = im.h;
    <span class="hljs-keyword">if</span> (((<span class="hljs-keyword">float</span>)w/im.w) &lt; ((<span class="hljs-keyword">float</span>)h/im.h)) {
        new_w = w;
        new_h = (im.h * w)/im.w;
    } <span class="hljs-keyword">else</span> {
        new_h = h;
        new_w = (im.w * h)/im.h;
    }
    image resized = resize_image(im, new_w, new_h);
    embed_image(resized, boxed, (w-new_w)/<span class="hljs-number">2</span>, (h-new_h)/<span class="hljs-number">2</span>);
    free_image(resized);
}
</code></pre>
<h2 id="letterboximage">letterbox_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">letterbox_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    <span class="hljs-keyword">int</span> new_w = im.w;
    <span class="hljs-keyword">int</span> new_h = im.h;
    <span class="hljs-keyword">if</span> (((<span class="hljs-keyword">float</span>)w/im.w) &lt; ((<span class="hljs-keyword">float</span>)h/im.h)) {
        new_w = w;
        new_h = (im.h * w)/im.w;
    } <span class="hljs-keyword">else</span> {
        new_h = h;
        new_w = (im.w * h)/im.h;
    }
    image resized = resize_image(im, new_w, new_h);
    image boxed = make_image(w, h, im.c);
    fill_image(boxed, <span class="hljs-number">.5</span>);
    <span class="hljs-comment">//int i;</span>
    <span class="hljs-comment">//for(i = 0; i &lt; boxed.w*boxed.h*boxed.c; ++i) boxed.data[i] = 0;</span>
    embed_image(resized, boxed, (w-new_w)/<span class="hljs-number">2</span>, (h-new_h)/<span class="hljs-number">2</span>);
    free_image(resized);
    <span class="hljs-keyword">return</span> boxed;
}
</code></pre>
<h2 id="resizemax">resize_max</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">resize_max</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> max)</span>
</span>{
    <span class="hljs-keyword">int</span> w = im.w;
    <span class="hljs-keyword">int</span> h = im.h;
    <span class="hljs-keyword">if</span>(w &gt; h){
        h = (h * max) / w;
        w = max;
    } <span class="hljs-keyword">else</span> {
        w = (w * max) / h;
        h = max;
    }
    <span class="hljs-keyword">if</span>(w == im.w &amp;&amp; h == im.h) <span class="hljs-keyword">return</span> im;
    image resized = resize_image(im, w, h);
    <span class="hljs-keyword">return</span> resized;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; resize&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="resizemin">resize_min</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">resize_min</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> min)</span>
</span>{
    <span class="hljs-keyword">int</span> w = im.w;
    <span class="hljs-keyword">int</span> h = im.h;
    <span class="hljs-keyword">if</span>(w &lt; h){
        h = (h * min) / w;
        w = min;
    } <span class="hljs-keyword">else</span> {
        w = (w * min) / h;
        h = min;
    }
    <span class="hljs-keyword">if</span>(w == im.w &amp;&amp; h == im.h) <span class="hljs-keyword">return</span> im;
    image resized = resize_image(im, w, h);
    <span class="hljs-keyword">return</span> resized;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; resize&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="randomcropimage">random_crop_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">random_crop_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    <span class="hljs-keyword">int</span> dx = rand_int(<span class="hljs-number">0</span>, im.w - w);
    <span class="hljs-keyword">int</span> dy = rand_int(<span class="hljs-number">0</span>, im.h - h);
    image crop = crop_image(im, dx, dy, w, h);
    <span class="hljs-keyword">return</span> crop;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC5D0;&#xC11C; &#xB79C;&#xB364;&#xD55C; &#xC601;&#xC5ED;&#xC744; crop&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="randomaugmentargs">random_augment_args</h2>
<pre><code class="lang-c"><span class="hljs-function">augment_args <span class="hljs-title">random_augment_args</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> angle, <span class="hljs-keyword">float</span> aspect, <span class="hljs-keyword">int</span> low, <span class="hljs-keyword">int</span> high, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    augment_args a = {<span class="hljs-number">0</span>};
    aspect = rand_scale(aspect);
    <span class="hljs-keyword">int</span> r = rand_int(low, high);
    <span class="hljs-keyword">int</span> min = (im.h &lt; im.w*aspect) ? im.h : im.w*aspect;
    <span class="hljs-keyword">float</span> scale = (<span class="hljs-keyword">float</span>)r / min;

    <span class="hljs-keyword">float</span> rad = rand_uniform(-angle, angle) * TWO_PI / <span class="hljs-number">360.</span>;

    <span class="hljs-keyword">float</span> dx = (im.w*scale/aspect - w) / <span class="hljs-number">2.</span>;
    <span class="hljs-keyword">float</span> dy = (im.h*scale - w) / <span class="hljs-number">2.</span>;
    <span class="hljs-comment">//if(dx &lt; 0) dx = 0;</span>
    <span class="hljs-comment">//if(dy &lt; 0) dy = 0;</span>
    dx = rand_uniform(-dx, dx);
    dy = rand_uniform(-dy, dy);

    a.rad = rad;
    a.scale = scale;
    a.w = w;
    a.h = h;
    a.dx = dx;
    a.dy = dy;
    a.aspect = aspect;
    <span class="hljs-keyword">return</span> a;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC5D0; &#xBCC0;&#xD658;&#xC5D0; &#xD544;&#xC694;&#xD55C; &#xC778;&#xC790;&#xAC12;&#xC744; &#xBC1B;&#xC544; &#xB79C;&#xB364;&#xD558;&#xAC8C; &#xBCC0;&#xD658;&#xD55C; &#xB4A4; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="randomaugmentimage">random_augment_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">random_augment_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> angle, <span class="hljs-keyword">float</span> aspect, <span class="hljs-keyword">int</span> low, <span class="hljs-keyword">int</span> high, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    augment_args a = random_augment_args(im, angle, aspect, low, high, w, h);
    image crop = rotate_crop_image(im, a.rad, a.scale, a.w, a.h, a.dx, a.dy, a.aspect);
    <span class="hljs-keyword">return</span> crop;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC5D0; &#xB79C;&#xB364;&#xD55C; &#xBCC0;&#xD658;&#xC744; &#xC8FC;&#xC5B4;&#xC11C; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="threewaymax">three_way_max</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">three_way_max</span><span class="hljs-params">(<span class="hljs-keyword">float</span> a, <span class="hljs-keyword">float</span> b, <span class="hljs-keyword">float</span> c)</span>
</span>{
    <span class="hljs-keyword">return</span> (a &gt; b) ? ( (a &gt; c) ? a : c) : ( (b &gt; c) ? b : c) ;
}
</code></pre>
<ul>
<li>3&#xAC1C;&#xC758; &#xAC12; &#xC911; &#xCD5C;&#xB313;&#xAC12;&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="threewaymin">three_way_min</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">three_way_min</span><span class="hljs-params">(<span class="hljs-keyword">float</span> a, <span class="hljs-keyword">float</span> b, <span class="hljs-keyword">float</span> c)</span>
</span>{
    <span class="hljs-keyword">return</span> (a &lt; b) ? ( (a &lt; c) ? a : c) : ( (b &lt; c) ? b : c) ;
}
</code></pre>
<ul>
<li>3&#xAC1C;&#xC758; &#xAC12; &#xC911; &#xCD5C;&#xC19F;&#xAC12;&#xC744; &#xBC18;&#xD658;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="yuvtorgb">yuv_to_rgb</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">yuv_to_rgb</span><span class="hljs-params">(image im)</span>
</span>{
    assert(im.c == <span class="hljs-number">3</span>);
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">float</span> r, g, b;
    <span class="hljs-keyword">float</span> y, u, v;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
            y = get_pixel(im, i , j, <span class="hljs-number">0</span>);
            u = get_pixel(im, i , j, <span class="hljs-number">1</span>);
            v = get_pixel(im, i , j, <span class="hljs-number">2</span>);

            r = y + <span class="hljs-number">1.13983</span>*v;
            g = y + <span class="hljs-number">-.39465</span>*u + <span class="hljs-number">-.58060</span>*v;
            b = y + <span class="hljs-number">2.03211</span>*u;

            set_pixel(im, i, j, <span class="hljs-number">0</span>, r);
            set_pixel(im, i, j, <span class="hljs-number">1</span>, g);
            set_pixel(im, i, j, <span class="hljs-number">2</span>, b);
        }
    }
}
</code></pre>
<ul>
<li><code>YUV</code> -&gt; <code>RGB</code></li>
</ul>
<h2 id="rgbtoyuv">rgb_to_yuv</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rgb_to_yuv</span><span class="hljs-params">(image im)</span>
</span>{
    assert(im.c == <span class="hljs-number">3</span>);
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">float</span> r, g, b;
    <span class="hljs-keyword">float</span> y, u, v;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
            r = get_pixel(im, i , j, <span class="hljs-number">0</span>);
            g = get_pixel(im, i , j, <span class="hljs-number">1</span>);
            b = get_pixel(im, i , j, <span class="hljs-number">2</span>);

            y = <span class="hljs-number">.299</span>*r + <span class="hljs-number">.587</span>*g + <span class="hljs-number">.114</span>*b;
            u = <span class="hljs-number">-.14713</span>*r + <span class="hljs-number">-.28886</span>*g + <span class="hljs-number">.436</span>*b;
            v = <span class="hljs-number">.615</span>*r + <span class="hljs-number">-.51499</span>*g + <span class="hljs-number">-.10001</span>*b;

            set_pixel(im, i, j, <span class="hljs-number">0</span>, y);
            set_pixel(im, i, j, <span class="hljs-number">1</span>, u);
            set_pixel(im, i, j, <span class="hljs-number">2</span>, v);
        }
    }
}
</code></pre>
<ul>
<li><code>RGB</code> -&gt; <code>YUV</code></li>
</ul>
<h2 id="rgbtohsv">rgb_to_hsv</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rgb_to_hsv</span><span class="hljs-params">(image im)</span>
</span>{
    assert(im.c == <span class="hljs-number">3</span>);
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">float</span> r, g, b;
    <span class="hljs-keyword">float</span> h, s, v;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
            r = get_pixel(im, i , j, <span class="hljs-number">0</span>);
            g = get_pixel(im, i , j, <span class="hljs-number">1</span>);
            b = get_pixel(im, i , j, <span class="hljs-number">2</span>);
            <span class="hljs-keyword">float</span> max = three_way_max(r,g,b);
            <span class="hljs-keyword">float</span> min = three_way_min(r,g,b);
            <span class="hljs-keyword">float</span> delta = max - min;
            v = max;
            <span class="hljs-keyword">if</span>(max == <span class="hljs-number">0</span>){
                s = <span class="hljs-number">0</span>;
                h = <span class="hljs-number">0</span>;
            }<span class="hljs-keyword">else</span>{
                s = delta/max;
                <span class="hljs-keyword">if</span>(r == max){
                    h = (g - b) / delta;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (g == max) {
                    h = <span class="hljs-number">2</span> + (b - r) / delta;
                } <span class="hljs-keyword">else</span> {
                    h = <span class="hljs-number">4</span> + (r - g) / delta;
                }
                <span class="hljs-keyword">if</span> (h &lt; <span class="hljs-number">0</span>) h += <span class="hljs-number">6</span>;
                h = h/<span class="hljs-number">6.</span>;
            }
            set_pixel(im, i, j, <span class="hljs-number">0</span>, h);
            set_pixel(im, i, j, <span class="hljs-number">1</span>, s);
            set_pixel(im, i, j, <span class="hljs-number">2</span>, v);
        }
    }
}
</code></pre>
<ul>
<li>RGB -&gt; HSV</li>
</ul>
<h2 id="hsvtorgb">hsv_to_rgb</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hsv_to_rgb</span><span class="hljs-params">(image im)</span>
</span>{
    assert(im.c == <span class="hljs-number">3</span>);
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">float</span> r, g, b;
    <span class="hljs-keyword">float</span> h, s, v;
    <span class="hljs-keyword">float</span> f, p, q, t;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
            h = <span class="hljs-number">6</span> * get_pixel(im, i , j, <span class="hljs-number">0</span>);
            s = get_pixel(im, i , j, <span class="hljs-number">1</span>);
            v = get_pixel(im, i , j, <span class="hljs-number">2</span>);
            <span class="hljs-keyword">if</span> (s == <span class="hljs-number">0</span>) {
                r = g = b = v;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">int</span> index = <span class="hljs-built_in">floor</span>(h);
                f = h - index;
                p = v*(<span class="hljs-number">1</span>-s);
                q = v*(<span class="hljs-number">1</span>-s*f);
                t = v*(<span class="hljs-number">1</span>-s*(<span class="hljs-number">1</span>-f));
                <span class="hljs-keyword">if</span>(index == <span class="hljs-number">0</span>){
                    r = v; g = t; b = p;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(index == <span class="hljs-number">1</span>){
                    r = q; g = v; b = p;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(index == <span class="hljs-number">2</span>){
                    r = p; g = v; b = t;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(index == <span class="hljs-number">3</span>){
                    r = p; g = q; b = v;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(index == <span class="hljs-number">4</span>){
                    r = t; g = p; b = v;
                } <span class="hljs-keyword">else</span> {
                    r = v; g = p; b = q;
                }
            }
            set_pixel(im, i, j, <span class="hljs-number">0</span>, r);
            set_pixel(im, i, j, <span class="hljs-number">1</span>, g);
            set_pixel(im, i, j, <span class="hljs-number">2</span>, b);
        }
    }
}
</code></pre>
<ul>
<li>HSV -&gt; RGB</li>
</ul>
<h2 id="grayscaleimage3c">grayscale_image_3c</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">grayscale_image_3c</span><span class="hljs-params">(image im)</span>
</span>{
    assert(im.c == <span class="hljs-number">3</span>);
    <span class="hljs-keyword">int</span> i, j, k;
    <span class="hljs-keyword">float</span> scale[] = {<span class="hljs-number">0.299</span>, <span class="hljs-number">0.587</span>, <span class="hljs-number">0.114</span>};
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
            <span class="hljs-keyword">float</span> val = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">3</span>; ++k){
                val += scale[k]*get_pixel(im, i, j, k);
            }
            im.data[<span class="hljs-number">0</span>*im.h*im.w + im.w*j + i] = val;
            im.data[<span class="hljs-number">1</span>*im.h*im.w + im.w*j + i] = val;
            im.data[<span class="hljs-number">2</span>*im.h*im.w + im.w*j + i] = val;
        }
    }
}
</code></pre>
<ul>
<li>&#xCC44;&#xB110;&#xC744; 3&#xAC1C; &#xAC00;&#xC9C0;&#xB294; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; grayscaling&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="grayscaleimage">grayscale_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">grayscale_image</span><span class="hljs-params">(image im)</span>
</span>{
    assert(im.c == <span class="hljs-number">3</span>);
    <span class="hljs-keyword">int</span> i, j, k;
    image gray = make_image(im.w, im.h, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">float</span> scale[] = {<span class="hljs-number">0.299</span>, <span class="hljs-number">0.587</span>, <span class="hljs-number">0.114</span>};
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; im.c; ++k){
        <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
                gray.data[i+im.w*j] += scale[k]*get_pixel(im, i, j, k);
            }
        }
    }
    <span class="hljs-keyword">return</span> gray;
}
</code></pre>
<ul>
<li>&#xCC44;&#xB110;&#xC744; 1&#xAC1C; &#xAC00;&#xC9C0;&#xB294; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; grayscaling&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="thresholdimage">threshold_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">threshold_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> thresh)</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    image t = make_image(im.w, im.h, im.c);
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w*im.h*im.c; ++i){
        t.data[i] = im.data[i]&gt;thresh ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">return</span> t;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC774;&#xC9C4;&#xD654; &#xD569;&#xB2C8;&#xB2E4;.<ul>
<li>thresh &#xCD08;&#xACFC;&#xC77C; &#xB54C; 1</li>
<li>thresh &#xC774;&#xD558;&#xC77C; &#xB54C; 0</li>
</ul>
</li>
</ul>
<h2 id="blendimage">blend_image</h2>
<pre><code class="lang-c">image blend_image(image fore, image back, float alpha)
{
    assert(fore.w == back.w &amp;&amp; fore.h == back.h &amp;&amp; fore.c == back.c);
    image blend = make_image(fore.w, fore.h, fore.c);
    int i, j, k;
    for(k = 0; k &lt; fore.c; ++k){
        for(j = 0; j &lt; fore.h; ++j){
            for(i = 0; i &lt; fore.w; ++i){
                float val = alpha * get_pixel(fore, i, j, k) +
                    (1 - alpha)* get_pixel(back, i, j, k);
                set_pixel(blend, i, j, k, val);
            }
        }
    }
    return blend;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0; 2&#xAC1C;&#xB97C; blending &#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="scaleimagechannel">scale_image_channel</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">scale_image_channel</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">float</span> v)</span>
</span>{
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
            <span class="hljs-keyword">float</span> pix = get_pixel(im, i, j, c);
            pix = pix*v;
            set_pixel(im, i, j, c, pix);
        }
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC758; &#xD2B9;&#xC815; &#xCC44;&#xB110; c&#xC5D0; v&#xB97C; &#xACF1;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="translateimagechannel">translate_image_channel</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">translate_image_channel</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">float</span> v)</span>
</span>{
    <span class="hljs-keyword">int</span> i, j;
    <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; im.h; ++j){
        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w; ++i){
            <span class="hljs-keyword">float</span> pix = get_pixel(im, i, j, c);
            pix = pix+v;
            set_pixel(im, i, j, c, pix);
        }
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC758; &#xD2B9;&#xC815; &#xCC44;&#xB110;&#xC5D0; v&#xB97C; &#xB354;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="binarizeimage">binarize_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">binarize_image</span><span class="hljs-params">(image im)</span>
</span>{
    image c = copy_image(im);
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w * im.h * im.c; ++i){
        <span class="hljs-keyword">if</span>(c.data[i] &gt; <span class="hljs-number">.5</span>) c.data[i] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> c.data[i] = <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">return</span> c;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC774;&#xC9C4;&#xD654; &#xD569;&#xB2C8;&#xB2E4;.<ul>
<li>0.5 &#xCD08;&#xACFC;&#xC77C; &#xB54C; 1</li>
<li>0.5 &#xC774;&#xD558;&#xC77C; &#xB54C; 0</li>
</ul>
</li>
</ul>
<h2 id="saturateimage">saturate_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">saturate_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> sat)</span>
</span>{
    rgb_to_hsv(im);
    scale_image_channel(im, <span class="hljs-number">1</span>, sat);
    hsv_to_rgb(im);
    constrain_image(im);
}
</code></pre>
<ul>
<li><p>HSV&#xC758; 1&#xBC88;&#xC9F8; &#xCC44;&#xB110;&#xC744; scaling&#xD558;&#xBA74; &#xCC44;&#xB3C4;(saturation)&#xB97C; &#xC870;&#xC808;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p>&#xC0C9;&#xC774; &#xC120;&#xBA85;&#xD55C; &#xC815;&#xB3C4;&#xB97C; &#xB098;&#xD0C0;&#xB0C5;&#xB2C8;&#xB2E4;.</p>
</li>
</ul>
<h2 id="hueimage">hue_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hue_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> hue)</span>
</span>{
    rgb_to_hsv(im);
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w*im.h; ++i){
        im.data[i] = im.data[i] + hue;
        <span class="hljs-keyword">if</span> (im.data[i] &gt; <span class="hljs-number">1</span>) im.data[i] -= <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (im.data[i] &lt; <span class="hljs-number">0</span>) im.data[i] += <span class="hljs-number">1</span>;
    }
    hsv_to_rgb(im);
    constrain_image(im);
}
</code></pre>
<ul>
<li>HSV&#xC758; 0&#xBC88;&#xC9F8; &#xCC44;&#xB110;&#xC744; &#xC870;&#xC808;&#xD558;&#xBA74; &#xC0C9;&#xC0C1;(hue)&#xC744; &#xC870;&#xC808;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="exposureimage">exposure_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exposure_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> sat)</span>
</span>{
    rgb_to_hsv(im);
    scale_image_channel(im, <span class="hljs-number">2</span>, sat);
    hsv_to_rgb(im);
    constrain_image(im);
}
</code></pre>
<ul>
<li><p>HSV&#xC758; 2&#xBC88;&#xC9F8; &#xCC44;&#xB110;&#xC744; scaling&#xD558;&#xBA74; &#xB178;&#xCD9C;(exposure)&#xB97C; &#xC870;&#xC808;&#xD560; &#xC218; &#xC788;&#xC2B5;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p>exposure&#xB294; brightness&#xC640; &#xBC1D;&#xAE30;&#xB97C; &#xBC1D;&#xAC8C; &#xD558;&#xAC70;&#xB098; &#xC5B4;&#xB461;&#xAC8C; &#xD558;&#xB294; &#xC5ED;&#xD560;&#xC744; &#xD569;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p>exposure&#xB294; &#xD558;&#xC774;&#xB77C;&#xC774;&#xD2B8; &#xC601;&#xC5ED;&#xC744; &#xC911;&#xC2EC;&#xC73C;&#xB85C; &#xBC1D;&#xAC8C;&#xD558;&#xACE0; &#xC5B4;&#xB461;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;.</p>
</li>
<li><p>brightness&#xB294; &#xBAA8;&#xB4E0; &#xC601;&#xC5ED;&#xC744; &#xB3D9;&#xC77C;&#xD558;&#xAC8C; &#xBC1D;&#xAC8C;&#xD558;&#xACE0; &#xC5B4;&#xB461;&#xAC8C; &#xD569;&#xB2C8;&#xB2E4;.</p>
</li>
</ul>
<h2 id="distortimage">distort_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">distort_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> hue, <span class="hljs-keyword">float</span> sat, <span class="hljs-keyword">float</span> val)</span>
</span>{
    rgb_to_hsv(im);
    scale_image_channel(im, <span class="hljs-number">1</span>, sat);
    scale_image_channel(im, <span class="hljs-number">2</span>, val);
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; im.w*im.h; ++i){
        im.data[i] = im.data[i] + hue;
        <span class="hljs-keyword">if</span> (im.data[i] &gt; <span class="hljs-number">1</span>) im.data[i] -= <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (im.data[i] &lt; <span class="hljs-number">0</span>) im.data[i] += <span class="hljs-number">1</span>;
    }
    hsv_to_rgb(im);
    constrain_image(im);
}
</code></pre>
<h2 id="randomdistortimage">random_distort_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">random_distort_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> hue, <span class="hljs-keyword">float</span> saturation, <span class="hljs-keyword">float</span> exposure)</span>
</span>{
    <span class="hljs-keyword">float</span> dhue = rand_uniform(-hue, hue);
    <span class="hljs-keyword">float</span> dsat = rand_scale(saturation);
    <span class="hljs-keyword">float</span> dexp = rand_scale(exposure);
    distort_image(im, dhue, dsat, dexp);
}
</code></pre>
<h2 id="saturateexposureimage">saturate_exposure_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">saturate_exposure_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">float</span> sat, <span class="hljs-keyword">float</span> exposure)</span>
</span>{
    rgb_to_hsv(im);
    scale_image_channel(im, <span class="hljs-number">1</span>, sat);
    scale_image_channel(im, <span class="hljs-number">2</span>, exposure);
    hsv_to_rgb(im);
    constrain_image(im);
}
</code></pre>
<ul>
<li>saturate&#xC640; exposure&#xB97C; &#xD568;&#xAED8; &#xC870;&#xC808;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="resizeimage">resize_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">resize_image</span><span class="hljs-params">(image im, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    image resized = make_image(w, h, im.c);   
    image part = make_image(w, im.h, im.c);
    <span class="hljs-keyword">int</span> r, c, k;
    <span class="hljs-keyword">float</span> w_scale = (<span class="hljs-keyword">float</span>)(im.w - <span class="hljs-number">1</span>) / (w - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">float</span> h_scale = (<span class="hljs-keyword">float</span>)(im.h - <span class="hljs-number">1</span>) / (h - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; im.c; ++k){
        <span class="hljs-keyword">for</span>(r = <span class="hljs-number">0</span>; r &lt; im.h; ++r){
            <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; w; ++c){
                <span class="hljs-keyword">float</span> val = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span>(c == w<span class="hljs-number">-1</span> || im.w == <span class="hljs-number">1</span>){
                    val = get_pixel(im, im.w<span class="hljs-number">-1</span>, r, k);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">float</span> sx = c*w_scale;
                    <span class="hljs-keyword">int</span> ix = (<span class="hljs-keyword">int</span>) sx;
                    <span class="hljs-keyword">float</span> dx = sx - ix;
                    val = (<span class="hljs-number">1</span> - dx) * get_pixel(im, ix, r, k) + <span class="hljs-function">dx * <span class="hljs-title">get_pixel</span><span class="hljs-params">(im, ix+<span class="hljs-number">1</span>, r, k)</span></span>;
                }
                set_pixel(part, c, r, k, val);
            }
        }
    }
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; im.c; ++k){
        <span class="hljs-keyword">for</span>(r = <span class="hljs-number">0</span>; r &lt; h; ++r){
            <span class="hljs-keyword">float</span> sy = r*h_scale;
            <span class="hljs-keyword">int</span> iy = (<span class="hljs-keyword">int</span>) sy;
            <span class="hljs-keyword">float</span> dy = sy - iy;
            <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; w; ++c){
                <span class="hljs-keyword">float</span> val = (<span class="hljs-number">1</span>-dy) * get_pixel(part, c, iy, k);
                set_pixel(resized, c, r, k, val);
            }
            <span class="hljs-keyword">if</span>(r == h<span class="hljs-number">-1</span> || im.h == <span class="hljs-number">1</span>) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; w; ++c){
                <span class="hljs-keyword">float</span> val = <span class="hljs-function">dy * <span class="hljs-title">get_pixel</span><span class="hljs-params">(part, c, iy+<span class="hljs-number">1</span>, k)</span></span>;
                add_pixel(resized, c, r, k, val);
            }
        }
    }

    free_image(part);
    <span class="hljs-keyword">return</span> resized;
}
</code></pre>
<h2 id="testresize">test_resize</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test_resize</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *filename)</span>
</span>{
    image im = load_image(filename, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>, <span class="hljs-number">3</span>);
    <span class="hljs-keyword">float</span> mag = mag_array(im.data, im.w*im.h*im.c);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;L2 Norm: %f\n&quot;</span>, mag);
    image gray = grayscale_image(im);

    image c1 = copy_image(im);
    image c2 = copy_image(im);
    image c3 = copy_image(im);
    image c4 = copy_image(im);
    distort_image(c1, <span class="hljs-number">.1</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">1.5</span>);
    distort_image(c2, <span class="hljs-number">-.1</span>, <span class="hljs-number">.66666</span>, <span class="hljs-number">.66666</span>);
    distort_image(c3, <span class="hljs-number">.1</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">.66666</span>);
    distort_image(c4, <span class="hljs-number">.1</span>, <span class="hljs-number">.66666</span>, <span class="hljs-number">1.5</span>);


    show_image(im,   <span class="hljs-string">&quot;Original&quot;</span>, <span class="hljs-number">1</span>);
    show_image(gray, <span class="hljs-string">&quot;Gray&quot;</span>, <span class="hljs-number">1</span>);
    show_image(c1, <span class="hljs-string">&quot;C1&quot;</span>, <span class="hljs-number">1</span>);
    show_image(c2, <span class="hljs-string">&quot;C2&quot;</span>, <span class="hljs-number">1</span>);
    show_image(c3, <span class="hljs-string">&quot;C3&quot;</span>, <span class="hljs-number">1</span>);
    show_image(c4, <span class="hljs-string">&quot;C4&quot;</span>, <span class="hljs-number">1</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> OPENCV</span>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){
        image aug = random_augment_image(im, <span class="hljs-number">0</span>, <span class="hljs-number">.75</span>, <span class="hljs-number">320</span>, <span class="hljs-number">448</span>, <span class="hljs-number">320</span>, <span class="hljs-number">320</span>);
        show_image(aug, <span class="hljs-string">&quot;aug&quot;</span>, <span class="hljs-number">1</span>);
        free_image(aug);


        <span class="hljs-keyword">float</span> exposure = <span class="hljs-number">1.15</span>;
        <span class="hljs-keyword">float</span> saturation = <span class="hljs-number">1.15</span>;
        <span class="hljs-keyword">float</span> hue = <span class="hljs-number">.05</span>;

        image c = copy_image(im);

        <span class="hljs-keyword">float</span> dexp = rand_scale(exposure);
        <span class="hljs-keyword">float</span> dsat = rand_scale(saturation);
        <span class="hljs-keyword">float</span> dhue = rand_uniform(-hue, hue);

        distort_image(c, dhue, dsat, dexp);
        show_image(c, <span class="hljs-string">&quot;rand&quot;</span>, <span class="hljs-number">1</span>);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%f %f %f\n&quot;</span>, dhue, dsat, dexp);
        free_image(c);
    }
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
}
</code></pre>
<h2 id="loadimagestb">load_image_stb</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">load_image_stb</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">int</span> channels)</span>
</span>{
    <span class="hljs-keyword">int</span> w, h, c;
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *data = stbi_load(filename, &amp;w, &amp;h, &amp;c, channels);
    <span class="hljs-keyword">if</span> (!data) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Cannot load image \&quot;%s\&quot;\nSTB Reason: %s\n&quot;</span>, filename, stbi_failure_reason());
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">if</span>(channels) c = channels;
    <span class="hljs-keyword">int</span> i,j,k;
    image im = make_image(w, h, c);
    <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; c; ++k){
        <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; h; ++j){
            <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; w; ++i){
                <span class="hljs-keyword">int</span> dst_index = i + w*j + w*h*k;
                <span class="hljs-keyword">int</span> src_index = k + c*i + c*w*j;
                im.data[dst_index] = (<span class="hljs-keyword">float</span>)data[src_index]/<span class="hljs-number">255.</span>;
            }
        }
    }
    <span class="hljs-built_in">free</span>(data);
    <span class="hljs-keyword">return</span> im;
}
</code></pre>
<ul>
<li>OPENCV&#xC5C6;&#xC774; &#xC774;&#xBBF8;&#xC9C0; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xB294; &#xD568;&#xC218;&#xC785;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="loadimage">load_image</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">load_image</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> c)</span>
</span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> OPENCV</span>
    image out = load_image_cv(filename, c);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    image out = load_image_stb(filename, c);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

    <span class="hljs-keyword">if</span>((h &amp;&amp; w) &amp;&amp; (h != out.h || w != out.w)){
        image resized = resize_image(out, w, h);
        free_image(out);
        out = resized;
    }
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0; &#xD30C;&#xC77C;&#xC744; &#xC77D;&#xC5B4;&#xB4E4;&#xC785;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="loadimagecolor">load_image_color</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">load_image_color</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h)</span>
</span>{
    <span class="hljs-keyword">return</span> load_image(filename, w, h, <span class="hljs-number">3</span>);
}
</code></pre>
<ul>
<li>COLOR &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xBD88;&#xB7EC;&#xC635;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="getimagelayer">get_image_layer</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">get_image_layer</span><span class="hljs-params">(image m, <span class="hljs-keyword">int</span> l)</span>
</span>{
    image out = make_image(m.w, m.h, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; m.h*m.w; ++i){
        out.data[i] = m.data[i+l*m.h*m.w];
    }
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<ul>
<li>&#xC778;&#xC790; &#xAC12; l&#xC5D0; &#xB530;&#xB77C;&#xC11C; &#xD2B9;&#xC815; &#xCC44;&#xB110; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC120;&#xD0DD;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="printimage">print_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_image</span><span class="hljs-params">(image m)</span>
</span>{
    <span class="hljs-keyword">int</span> i, j, k;
    <span class="hljs-keyword">for</span>(i =<span class="hljs-number">0</span> ; i &lt; m.c; ++i){
        <span class="hljs-keyword">for</span>(j =<span class="hljs-number">0</span> ; j &lt; m.h; ++j){
            <span class="hljs-keyword">for</span>(k = <span class="hljs-number">0</span>; k &lt; m.w; ++k){
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.2lf, &quot;</span>, m.data[i*m.h*m.w + j*m.w + k]);
                <span class="hljs-keyword">if</span>(k &gt; <span class="hljs-number">30</span>) <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
            <span class="hljs-keyword">if</span>(j &gt; <span class="hljs-number">30</span>) <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0; &#xD53D;&#xC140; &#xAC12;&#xB4E4;&#xC744; &#xCD9C;&#xB825;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="collapseimagesvert">collapse_images_vert</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">collapse_images_vert</span><span class="hljs-params">(image *ims, <span class="hljs-keyword">int</span> n)</span>
</span>{
    <span class="hljs-keyword">int</span> color = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> border = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> h,w,c;
    w = ims[<span class="hljs-number">0</span>].w;
    h = (ims[<span class="hljs-number">0</span>].h + border) * n - border;
    c = ims[<span class="hljs-number">0</span>].c;
    <span class="hljs-keyword">if</span>(c != <span class="hljs-number">3</span> || !color){
        w = (w+border)*c - border;
        c = <span class="hljs-number">1</span>;
    }

    image filters = make_image(w, h, c);
    <span class="hljs-keyword">int</span> i,j;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; n; ++i){
        <span class="hljs-keyword">int</span> h_offset = i*(ims[<span class="hljs-number">0</span>].h+border);
        image copy = copy_image(ims[i]);
        <span class="hljs-comment">//normalize_image(copy);</span>
        <span class="hljs-keyword">if</span>(c == <span class="hljs-number">3</span> &amp;&amp; color){
            embed_image(copy, filters, <span class="hljs-number">0</span>, h_offset);
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; copy.c; ++j){
                <span class="hljs-keyword">int</span> w_offset = j*(ims[<span class="hljs-number">0</span>].w+border);
                image layer = get_image_layer(copy, j);
                embed_image(layer, filters, w_offset, h_offset);
                free_image(layer);
            }
        }
        free_image(copy);
    }
    <span class="hljs-keyword">return</span> filters;
}
</code></pre>
<ul>
<li>&#xC5EC;&#xB7EC;&#xC7A5;&#xC758; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC218;&#xC9C1;&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="collapseimageshorz">collapse_images_horz</h2>
<pre><code class="lang-c"><span class="hljs-function">image <span class="hljs-title">collapse_images_horz</span><span class="hljs-params">(image *ims, <span class="hljs-keyword">int</span> n)</span>
</span>{
    <span class="hljs-keyword">int</span> color = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> border = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> h,w,c;
    <span class="hljs-keyword">int</span> size = ims[<span class="hljs-number">0</span>].h;
    h = size;
    w = (ims[<span class="hljs-number">0</span>].w + border) * n - border;
    c = ims[<span class="hljs-number">0</span>].c;
    <span class="hljs-keyword">if</span>(c != <span class="hljs-number">3</span> || !color){
        h = (h+border)*c - border;
        c = <span class="hljs-number">1</span>;
    }

    image filters = make_image(w, h, c);
    <span class="hljs-keyword">int</span> i,j;
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; n; ++i){
        <span class="hljs-keyword">int</span> w_offset = i*(size+border);
        image copy = copy_image(ims[i]);
        <span class="hljs-comment">//normalize_image(copy);</span>
        <span class="hljs-keyword">if</span>(c == <span class="hljs-number">3</span> &amp;&amp; color){
            embed_image(copy, filters, w_offset, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; copy.c; ++j){
                <span class="hljs-keyword">int</span> h_offset = j*(size+border);
                image layer = get_image_layer(copy, j);
                embed_image(layer, filters, w_offset, h_offset);
                free_image(layer);
            }
        }
        free_image(copy);
    }
    <span class="hljs-keyword">return</span> filters;
}
</code></pre>
<ul>
<li>&#xC5EC;&#xB7EC;&#xC7A5;&#xC758; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC218;&#xD3C9;&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="showimagenormalized">show_image_normalized</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show_image_normalized</span><span class="hljs-params">(image im, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span>
</span>{
    image c = copy_image(im);
    normalize_image(c);
    show_image(c, name, <span class="hljs-number">1</span>);
    free_image(c);
}
</code></pre>
<ul>
<li>&#xC815;&#xADDC;&#xD654;&#xD55C; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="showimages">show_images</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show_images</span><span class="hljs-params">(image *ims, <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">char</span> *window)</span>
</span>{
    image m = collapse_images_vert(ims, n);

    normalize_image(m);
    save_image(m, window);
    show_image(m, window, <span class="hljs-number">1</span>);
    free_image(m);
}
</code></pre>
<ul>
<li>&#xC5EC;&#xB7EC;&#xC7A5;&#xC758; &#xC774;&#xBBF8;&#xC9C0;&#xB97C; &#xC218;&#xC9C1;&#xC73C;&#xB85C; &#xC5F0;&#xACB0;&#xD55C; &#xB4A4; &#xC815;&#xADDC;&#xD654;&#xD558;&#xACE0; &#xC800;&#xC7A5;&#xD558;&#xACE0; &#xBCF4;&#xC5EC;&#xC90D;&#xB2C8;&#xB2E4;.</li>
</ul>
<h2 id="freeimage">free_image</h2>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">free_image</span><span class="hljs-params">(image m)</span>
</span>{
    <span class="hljs-keyword">if</span>(m.data){
        <span class="hljs-built_in">free</span>(m.data);
    }
}
</code></pre>
<ul>
<li>&#xC774;&#xBBF8;&#xC9C0;&#xC758; &#xBA54;&#xBAA8;&#xB9AC; &#xD560;&#xB2F9;&#xC744; &#xD574;&#xC81C;&#xD569;&#xB2C8;&#xB2E4;.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="im2col.html" class="navigation navigation-prev " aria-label="Previous page: im2col.c">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="iseg_layer.html" class="navigation navigation-next " aria-label="Next page: iseg_layer.c">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"image.c","level":"5.22","depth":1,"next":{"title":"iseg_layer.c","level":"5.23","depth":1,"path":"part3_src/iseg_layer.md","ref":"part3_src/iseg_layer.md","articles":[]},"previous":{"title":"im2col.c","level":"5.21","depth":1,"path":"part3_src/im2col.md","ref":"part3_src/im2col.md","articles":[]},"dir":"ltr"},"config":{"plugins":["advanced-emoji","theme-gestalt","-theme-default","styles-sass-fix","theme-api","mathjax"],"root":"./","styles":{"website":"website-1599634348142.css"},"pluginsConfig":{"styles-sass-fix":{},"theme-gestalt":{"showLevel":false,"styles":{"website":"styles/website.css"},"logo":"/darknet_book/assets/darknet.png","baseUrl":null,"excludeDefaultStyles":true,"doNotHideChildrenChapters":false},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"theme-api":{"languages":[],"split":true,"theme":"light"},"mathjax":{"forceSVG":false,"version":"2.6-latest"},"advanced-emoji":{"embedEmojis":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]}},"theme":"default","author":"JJM","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"DarkNet Book","output.name":"site","gitbook":"*"},"file":{"path":"part3_src/image.md","mtime":"2020-09-09T05:02:45.218Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-09-09T06:52:18.609Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

